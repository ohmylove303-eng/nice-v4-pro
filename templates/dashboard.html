<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NICE v4 PRO - ì „ë¬¸ê°€ ë ˆë²¨ AI ê±°ë˜ ì‹œìŠ¤í…œ</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap"
        rel="stylesheet">

    <style>
        * {
            font-family: 'Noto Sans KR', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a0a15 0%, #1a1a2e 100%);
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        /* Type ë±ƒì§€ */
        .type-a {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .type-b {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .type-c {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .type-badge {
            padding: 4px 12px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 11px;
        }

        /* ë©”ì´ì €/ê¸°íƒ€ ë±ƒì§€ */
        .badge-major {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid #f87171;
        }

        .badge-other {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid #fbbf24;
        }

        /* ì½”ì¸ ì¹´ë“œ */
        .coin-card {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .coin-card:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: #00d4ff;
            transform: translateY(-2px);
        }

        .coin-card.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.15);
        }

        /* Market Map */
        .market-map-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            font-size: 10px;
            font-weight: 700;
            border-radius: 4px;
            padding: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .market-map-cell:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .market-map-cell.bullish {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .market-map-cell.bearish {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .market-map-cell.neutral {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        /* ëª¨ë‹¬ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border-radius: 16px;
            padding: 24px;
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .score-bar-bg {
            background: rgba(0, 212, 255, 0.2);
            height: 5px;
            border-radius: 3px;
            overflow: hidden;
        }

        .fill-green {
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        .fill-yellow {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }

        .fill-red {
            background: linear-gradient(90deg, #ef4444, #f87171);
        }

        /* Flow ì•„ì´í…œ */
        .flow-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .flow-item:last-child {
            border-bottom: none;
        }

        /* ì§€í‘œ ë²„íŠ¼ */
        .indicator-btn {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .indicator-btn.active {
            background: rgba(16, 185, 129, 0.3);
            border: 1px solid #10b981;
        }

        .indicator-btn:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* ì¹´í…Œê³ ë¦¬ íƒ­ */
        .tab-btn {
            padding: 10px 16px;
            background: rgba(0, 212, 255, 0.15);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: #00d4ff;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab-btn.active {
            background: rgba(16, 185, 129, 0.4);
            border-color: #10b981;
            color: #10b981;
        }

        .tab-btn:hover {
            background: rgba(0, 212, 255, 0.25);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>

<body class="text-white">
    <div id="app" class="min-h-screen">

        <!-- í—¤ë” -->
        <header class="glass-card sticky top-0 z-50 mb-3" style="border-radius: 0;">
            <div class="container mx-auto px-3 py-2">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                        <h1 class="text-base font-black">ğŸ¯ NICE v4 PRO</h1>
                        <span id="main-type" class="type-badge type-a">Type A</span>
                        <span class="font-bold text-emerald-400" id="main-score">86ì </span>
                    </div>
                    <div class="flex items-center gap-3 text-xs">
                        <span class="pulse text-emerald-400">â— LIVE</span>
                        <span class="text-gray-400" id="last-update">18:40 ê°±ì‹ </span>
                    </div>
                </div>

                <!-- ìƒíƒœ ë°” -->
                <div class="grid grid-cols-3 md:grid-cols-6 gap-2 text-center text-xs">
                    <div class="glass-card p-2">
                        <div class="text-gray-400">ìµœê³  ì‹ í˜¸</div>
                        <div class="font-bold text-emerald-400" id="top-signal">BTC/ETH</div>
                    </div>
                    <div class="glass-card p-2">
                        <div class="text-gray-400">ğŸŸ¢ Type A</div>
                        <div class="font-bold" id="type-a-count">7ê°œ</div>
                    </div>
                    <div class="glass-card p-2">
                        <div class="text-gray-400">ë‹¤ìŒ ë¦¬í¬íŠ¸</div>
                        <div class="font-bold" id="next-report">19:00</div>
                    </div>
                    <div class="glass-card p-2">
                        <div class="text-gray-400">ì¶”ì²œ Kelly</div>
                        <div class="font-bold text-emerald-400" id="avg-kelly">3.1%</div>
                    </div>
                    <div class="glass-card p-2">
                        <div class="text-gray-400">Fear & Greed</div>
                        <div class="font-bold" id="fear-greed">55 íƒìš•</div>
                    </div>
                    <div class="glass-card p-2">
                        <div class="text-gray-400">Net Flow</div>
                        <div class="font-bold text-emerald-400" id="net-flow">+$2.4B</div>
                    </div>
                </div>
            </div>
        </header>

        <main class="container mx-auto px-3 space-y-3">

            <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
            <div class="flex gap-2 overflow-x-auto pb-2">
                <button class="tab-btn active" data-tab="scalp">ğŸ’¥ ë‹¨íƒ€ (5~30ë¶„)</button>
                <button class="tab-btn" data-tab="short">ğŸ“ˆ ë‹¨ê¸° (30ë¶„~2ì‹œê°„)</button>
                <button class="tab-btn" data-tab="medium">ğŸ”„ ì¤‘ê¸° (2ì‹œê°„~1ì¼)</button>
                <button class="tab-btn" data-tab="long">ğŸ“Š ì¥ê¸° (1ì¼~1ì£¼)</button>
                <button class="tab-btn" data-tab="report">ğŸ“‹ AI ë¦¬í¬íŠ¸</button>
            </div>

            <!-- íƒ­ ì½˜í…ì¸  ì»¨í…Œì´ë„ˆ (í†µí•© ë·°) -->
            <div id="dashboard-view" class="tab-content active">
                <!-- ì°¨íŠ¸ + Market Map -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-3">
                    <!-- TradingView ì°¨íŠ¸ -->
                    <div class="lg:col-span-2 glass-card p-3">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <span class="font-bold" id="chart-symbol">BTC</span>
                                <span class="text-gray-400 text-sm" id="chart-name">Bitcoin</span>
                                <span class="text-emerald-400 font-bold" id="chart-price">$45,200</span>
                                <span class="text-emerald-400 text-sm" id="chart-change">+2.5%</span>
                            </div>
                            <div class="flex gap-1" id="timeframe-buttons">
                                <button class="indicator-btn active" data-tf="5">5M</button>
                                <button class="indicator-btn" data-tf="15">15M</button>
                                <button class="indicator-btn" data-tf="60">1H</button>
                                <button class="indicator-btn" data-tf="240">4H</button>
                                <button class="indicator-btn" data-tf="D">1D</button>
                            </div>
                        </div>
                        <div id="tradingview-chart"
                            style="height: 320px; background: rgba(0,0,0,0.3); border-radius: 8px; overflow: hidden;">
                            <!-- TradingView Widget -->
                            <div id="tv-widget-container" style="width: 100%; height: 100%;"></div>
                        </div>
                        <!-- ì§€í‘œ ë°” -->
                        <div class="flex gap-2 mt-2 flex-wrap">
                            <span class="indicator-btn active">BB (20,2)</span>
                            <span class="indicator-btn active">RSI (14)</span>
                            <span class="indicator-btn active">MACD (12,26,9)</span>
                            <span class="indicator-btn active">EMA (20/50/200)</span>
                            <span class="indicator-btn active">Volume</span>
                            <span class="indicator-btn active">Stoch RSI</span>
                        </div>
                    </div>

                    <!-- Market Map -->
                    <div class="glass-card p-3">
                        <h3 class="font-bold text-sm mb-2">ğŸ—ºï¸ ì‹œì¥ ì§€ë„ (Market Map)</h3>
                        <div class="grid grid-cols-4 gap-1" id="market-map" style="height: 320px; overflow-y: auto;">
                            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                            <div class="text-center text-gray-500 py-10">ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                </div>

                <!-- AI ë¶„ì„ íŒ¨ë„ -->
                <div class="glass-card p-3 mt-3" id="ai-analysis-panel">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-lg">ğŸ¤–</span>
                        <h3 class="font-bold">AI íˆ¬ì ë¶„ì„</h3>
                        <span class="text-xs text-gray-400" id="selected-coin-name">BTC Bitcoin</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3 text-sm" id="ai-analysis-content">
                        <!-- ìœ í†µëŸ‰ -->
                        <div class="glass-card p-3">
                            <div class="text-gray-400 text-xs mb-1">ğŸ“Š ìœ í†µëŸ‰</div>
                            <div class="font-bold" id="ai-circulation">-</div>
                            <div class="text-xs text-gray-400" id="ai-supply">-</div>
                        </div>
                        <!-- ì£¼í¬ í¬ì§„ -->
                        <div class="glass-card p-3">
                            <div class="text-gray-400 text-xs mb-1">ğŸ‹ ì£¼í¬ í¬ì§„</div>
                            <div class="font-bold text-emerald-400" id="ai-whale">-</div>
                            <div class="text-xs text-gray-400" id="ai-whale-detail">-</div>
                        </div>
                        <!-- í”„ë ‰íƒˆ í•¸ë“¤ë§ -->
                        <div class="glass-card p-3">
                            <div class="text-gray-400 text-xs mb-1">ğŸ“ í”„ë ‰íƒˆ í•¸ë“¤ë§</div>
                            <div class="font-bold text-cyan-400" id="ai-fractal">-</div>
                            <div class="text-xs text-gray-400" id="ai-fractal-detail">-</div>
                        </div>
                        <!-- ê±°ë˜ ì¶”ì²œ -->
                        <div class="glass-card p-3">
                            <div class="text-gray-400 text-xs mb-1">ğŸ¯ ê±°ë˜ ì¶”ì²œ</div>
                            <div class="grid grid-cols-3 gap-1 text-xs">
                                <div><span class="text-gray-400">ì§„ì…</span><br><span class="font-bold"
                                        id="ai-entry">-</span></div>
                                <div><span class="text-gray-400">ì†ì ˆ</span><br><span class="text-red-400 font-bold"
                                        id="ai-sl">-</span></div>
                                <div><span class="text-gray-400">ìµì ˆ</span><br><span class="text-emerald-400 font-bold"
                                        id="ai-tp">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Final Top 5 Tables -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 mt-3">

                    <!-- ë©”ì´ì € ì½”ì¸ Top 5 -->
                    <div class="glass-card p-3">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">ğŸ†</span>
                                <h3 class="font-bold">Final Top 5 - ë©”ì´ì € ì½”ì¸</h3>
                            </div>
                            <span class="text-xs text-gray-400" id="major-sort-criteria">ìƒìŠ¹ëŸ‰ â†’ ê±°ë˜ëŸ‰ â†’ NICE</span>
                        </div>
                        <div class="space-y-2" id="major-coins-list">
                            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                            <div class="text-center text-gray-500 py-4">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>

                    <!-- ê¸°íƒ€ ì½”ì¸ Top 5 -->
                    <div class="glass-card p-3">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">â­</span>
                                <h3 class="font-bold">Final Top 5 - ê¸°íƒ€ ì½”ì¸</h3>
                            </div>
                            <span class="text-xs text-gray-400">ê³ ìˆ˜ìµ Â· ê³ ë³€ë™</span>
                        </div>
                        <div class="space-y-2" id="other-coins-list">
                            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                            <div class="text-center text-gray-500 py-4">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI ë¦¬í¬íŠ¸ íƒ­ (ê³ ì • ë ˆì´ì•„ì›ƒ) -->
            <div id="tab-report" class="tab-content"
                style="height: calc(100vh - 180px); display: flex; flex-direction: column; overflow: hidden;">
                <!-- ìƒë‹¨ ìš”ì•½ ì¹´ë“œ (ê³ ì • ë†’ì´) -->
                <div class="glass-card p-3 mb-2" style="flex-shrink: 0;">
                    <h3 class="font-bold text-lg text-emerald-400 mb-2">ğŸŸ¢ TYPE A ì‹ í˜¸ í¬ì°©!</h3>
                    <div class="grid grid-cols-4 gap-3 text-sm">
                        <div>
                            <div class="text-gray-400 text-xs">ì‹ ë¢°ë„</div>
                            <div class="font-bold">76%</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">ìµœì¢… ì ìˆ˜</div>
                            <div class="font-bold text-emerald-400">86/100</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">ì¶”ì²œ Kelly</div>
                            <div class="font-bold">4.0%</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">ì‹œì¥ ìƒíƒœ</div>
                            <div class="font-bold">BULL</div>
                        </div>
                    </div>
                </div>

                <!-- ì¤‘ê°„ ì˜ì—­: ì°¨íŠ¸ (40%) + ì „ë¬¸ê°€ (60%) -->
                <div class="flex-1 grid grid-cols-5 gap-2 min-h-0">
                    <!-- ë ˆì´ì–´ ì°¨íŠ¸ (40%) -->
                    <div class="col-span-2 glass-card p-3 flex flex-col">
                        <h3 class="font-bold text-sm mb-2">ğŸ“Š ë ˆì´ì–´ë³„ ë¶„ì„</h3>
                        <div class="flex-1 min-h-0">
                            <canvas id="layerChart" style="width: 100%; height: 100%;"></canvas>
                        </div>
                    </div>

                    <!-- ì „ë¬¸ê°€ ê´€ì  (60%) - ìŠ¤í¬ë¡¤ ê°€ëŠ¥ -->
                    <div class="col-span-3 glass-card p-3 flex flex-col">
                        <h3 class="font-bold text-sm mb-2">ğŸ’¼ ì „ë¬¸ê°€ ê´€ì </h3>
                        <div id="expert-views" class="flex-1 overflow-y-auto space-y-2 text-sm pr-1"
                            style="max-height: 100%;">
                            ë¡œë”© ì¤‘...
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- ì½”ì¸ ìƒì„¸ ë¶„ì„ ëª¨ë‹¬ -->
        <div class="modal-overlay" id="coin-modal">
            <div class="modal-content" style="max-width: 900px;">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-3">
                        <h2 class="text-xl font-bold" id="modal-title">BTC Bitcoin</h2>
                        <span id="modal-type-badge" class="type-badge type-a">Type A</span>
                        <span id="modal-price" class="text-emerald-400 font-bold">$98,000</span>
                        <span id="modal-change" class="text-emerald-400">+2.5%</span>
                    </div>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                </div>

                <!-- ë¯¸ë‹ˆ ì°¨íŠ¸ -->
                <div class="glass-card p-3 mb-4" style="height: 200px;">
                    <div id="modal-chart-container" style="width: 100%; height: 100%;"></div>
                </div>

                <!-- AI íˆ¬ì ë¶„ì„ -->
                <div class="glass-card p-3 mb-4">
                    <h3 class="font-bold text-emerald-400 mb-3">ğŸ¤– AI íˆ¬ì ë¶„ì„</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                        <div class="glass-card p-2">
                            <div class="text-gray-400 text-xs">ğŸ“Š ìœ í†µëŸ‰</div>
                            <div class="font-bold" id="modal-circulation">93.2%</div>
                            <div class="text-xs text-gray-400" id="modal-supply">19.8M / 21M</div>
                        </div>
                        <div class="glass-card p-2">
                            <div class="text-gray-400 text-xs">ğŸ‹ ì£¼í¬ í¬ì§„</div>
                            <div class="font-bold text-cyan-400" id="modal-whale">ì¶•ì  ì¤‘</div>
                            <div class="text-xs text-gray-400" id="modal-whale-detail">152 ì§€ê°‘, 38.5%</div>
                        </div>
                        <div class="glass-card p-2">
                            <div class="text-gray-400 text-xs">ğŸ“ í”„ë ‰íƒˆ í•¸ë“¤ë§</div>
                            <div class="font-bold text-purple-400" id="modal-fractal">Higher High</div>
                            <div class="text-xs text-gray-400" id="modal-fractal-detail">ê°•ë„ 82%</div>
                        </div>
                        <div class="glass-card p-2">
                            <div class="text-gray-400 text-xs">ğŸ¯ NICE ì ìˆ˜</div>
                            <div class="font-bold text-emerald-400" id="modal-nice-score">86</div>
                            <div class="text-xs text-gray-400" id="modal-nice-type">Type A ì‹ í˜¸</div>
                        </div>
                    </div>
                </div>

                <!-- ê±°ë˜ ì¶”ì²œ -->
                <div class="glass-card p-3 mb-4" style="background: rgba(16, 185, 129, 0.1); border-color: #10b981;">
                    <h3 class="font-bold text-emerald-400 mb-3">ğŸ¯ ê±°ë˜ ì¶”ì²œ (í˜„ì¬ ì‹œê°„ ê¸°ì¤€)</h3>
                    <div class="grid grid-cols-3 md:grid-cols-6 gap-3 text-center text-sm">
                        <div>
                            <div class="text-gray-400 text-xs">ì§„ì…ê°€</div>
                            <div class="font-bold text-cyan-400" id="modal-entry">$97,500</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">ì†ì ˆê°€ (SL)</div>
                            <div class="font-bold text-red-400" id="modal-sl">$95,550</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">ìµì ˆê°€ (TP)</div>
                            <div class="font-bold text-emerald-400" id="modal-tp">$101,920</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">ì†ìµë¹„ (R:R)</div>
                            <div class="font-bold text-yellow-400" id="modal-rr">1:2.2</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">Kelly %</div>
                            <div class="font-bold" id="modal-kelly">4.0%</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">Time-Stop</div>
                            <div class="font-bold" id="modal-timestop">30ë¶„</div>
                        </div>
                    </div>
                </div>

                <!-- ë§¤ìˆ˜/ë§¤ë„ ë²„íŠ¼ -->
                <div class="grid grid-cols-2 gap-4">
                    <button id="modal-buy-btn" class="py-3 rounded-lg font-bold text-lg transition-all hover:scale-105"
                        style="background: linear-gradient(135deg, #10b981, #059669);">
                        ğŸ“ˆ ë§¤ìˆ˜ ì¶”ì²œ
                    </button>
                    <button id="modal-sell-btn"
                        class="py-3 rounded-lg font-bold text-lg transition-all hover:scale-105 opacity-50"
                        style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                        ğŸ“‰ ë§¤ë„ (ë³´ë¥˜)
                    </button>
                </div>

                <!-- ì‹œê°„ ì •ë³´ -->
                <div class="text-center text-xs text-gray-400 mt-3">
                    ë¶„ì„ ì‹œê°: <span id="modal-time">19:45:00</span> | ìœ íš¨ ì‹œê°„: 30ë¶„ | ë‹¤ìŒ ê°±ì‹ : <span
                        id="modal-next-update">20:00</span>
                </div>
            </div>
        </div>

        <footer class="text-center py-3 text-gray-500 text-xs">
            NICE v4 PRO | ë¸”ë™ë¡ Ã— JPëª¨ê±´ Ã— ì „ë¬¸ íŠ¸ë ˆì´ë” í†µí•© ë¶„ì„ | ë¹—ì¸ 448ê°œ ì½”ì¸ ë¶„ì„
        </footer>
    </div>

    <!-- TradingView ìœ„ì ¯ ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <script>
        let selectedCoin = 'BTC';
        let tvWidget = null;

        // ì‹œì¥ ì§€ë„ ë°ì´í„°
        const marketMapData = [
            { symbol: 'BTC', name: 'Bitcoin', change: 2.5, sector: 'L1', size: 4 },
            { symbol: 'ETH', name: 'Ethereum', change: 3.2, sector: 'L1', size: 3 },
            { symbol: 'SOL', name: 'Solana', change: 5.1, sector: 'L1', size: 2 },
            { symbol: 'XRP', name: 'Ripple', change: 1.8, sector: 'L1', size: 2 },
            { symbol: 'BNB', name: 'BNB', change: -1.2, sector: 'Ex', size: 2 },
            { symbol: 'DOGE', name: 'Doge', change: 8.5, sector: 'Meme', size: 2 },
            { symbol: 'ADA', name: 'Cardano', change: -0.5, sector: 'L1', size: 1 },
            { symbol: 'AVAX', name: 'Avalanche', change: 4.2, sector: 'L1', size: 1 },
            { symbol: 'DOT', name: 'Polkadot', change: -2.1, sector: 'L1', size: 1 },
            { symbol: 'LINK', name: 'Chainlink', change: 2.1, sector: 'DeFi', size: 1 },
            { symbol: 'MATIC', name: 'Polygon', change: 1.5, sector: 'L2', size: 1 },
            { symbol: 'SHIB', name: 'Shiba', change: 12.3, sector: 'Meme', size: 1 },
            { symbol: 'PEPE', name: 'Pepe', change: 15.2, sector: 'Meme', size: 1 },
            { symbol: 'APT', name: 'Aptos', change: 6.8, sector: 'L1', size: 1 },
            { symbol: 'SUI', name: 'Sui', change: 9.2, sector: 'L1', size: 1 },
            { symbol: 'OP', name: 'Optimism', change: 3.5, sector: 'L2', size: 1 },
            { symbol: 'ARB', name: 'Arbitrum', change: -1.8, sector: 'L2', size: 1 },
            { symbol: 'UNI', name: 'Uniswap', change: 2.8, sector: 'DeFi', size: 1 },
            { symbol: 'NEAR', name: 'Near', change: 3.5, sector: 'L1', size: 1 },
            { symbol: 'WIF', name: 'Dogwifhat', change: 18.5, sector: 'Meme', size: 1 }
        ];

        // TradingView ìœ„ì ¯ ì´ˆê¸°í™” (ëª¨ë“  ì§€í‘œ í¬í•¨)
        function initTradingView(symbol = 'BTC', interval = '5') {
            const container = document.getElementById('tv-widget-container');
            container.innerHTML = '';

            // TradingView Interval ë§¤í•‘
            const intervalMap = {
                'scalp': '5',
                'short': '15',
                'medium': '60',
                'long': '240'  // 4ì‹œê°„
            };

            // ë§Œì•½ interval íŒŒë¼ë¯¸í„°ê°€ timeframe ë¬¸ìì—´ì´ë©´ ë§¤í•‘ëœ ê°’ ì‚¬ìš©
            const tvInterval = intervalMap[interval] || interval;

            new TradingView.widget({
                "autosize": true,
                "symbol": `BITHUMB:${symbol}KRW`,
                "interval": tvInterval,
                "timezone": "Asia/Seoul",
                "theme": "dark",
                "style": "1",
                "locale": "kr",
                "toolbar_bg": "#1a1a2e",
                "enable_publishing": false,
                "hide_top_toolbar": false,
                "hide_legend": false,
                "save_image": false,
                "container_id": "tv-widget-container",
                "studies": [
                    "BB@tv-basicstudies",           // ë³¼ë¦°ì € ë°´ë“œ
                    "RSI@tv-basicstudies",          // RSI
                    "MACD@tv-basicstudies",         // MACD
                    "MAExp@tv-basicstudies",        // EMA 20
                    "MAExp@tv-basicstudies",        // EMA 50
                    "MAExp@tv-basicstudies",        // EMA 200
                    "Volume@tv-basicstudies",       // ê±°ë˜ëŸ‰
                    "StochasticRSI@tv-basicstudies" // ìŠ¤í† ìºìŠ¤í‹± RSI
                ],
                "studies_overrides": {
                    "volume.volume.color.0": "#ef4444",
                    "volume.volume.color.1": "#10b981"
                }
            });

            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.indicator-btn[data-tf]').forEach(btn => btn.classList.remove('active'));
            // ê°€ì¥ ê·¼ì ‘í•œ ë²„íŠ¼ ì°¾ê¸° (ë‹¨ìˆœí™”)
            const btn = document.querySelector(`.indicator-btn[data-tf="${tvInterval}"]`) ||
                document.querySelector(`.indicator-btn[data-tf="5"]`);
            if (btn) btn.classList.add('active');
        }

        let currentChartInstance = null; // ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì „ì—­ ê´€ë¦¬
        // AI ë¦¬í¬íŠ¸ ë°ì´í„° ë¡œë“œ (ë ˆì´ì–´ ì°¨íŠ¸ + ìš”ì•½)
        async function loadAIReport() {
            const ctx = document.getElementById('layerChart');
            if (!ctx) return;

            try {
                // ì‹œì¥ ë¶„ì„ API í˜¸ì¶œ
                const res = await fetch('/api/nice/market');
                const data = await res.json();

                if (data.error) {
                    console.error('AI Report error:', data.error);
                    return;
                }

                // ë ˆì´ì–´ ì ìˆ˜ ì¶”ì¶œ
                const layers = data.layers || {};
                const scores = [
                    layers.technical?.score || 0,
                    layers.onchain?.score || 0,
                    layers.sentiment?.score || 0,
                    layers.macro?.score || 0,
                    layers.etf?.score || 0
                ];

                // ì´ì  ë° ì‹ í˜¸ íƒ€ì… ì—…ë°ì´íŠ¸
                const totalScore = data.total_score || 0;
                const signalType = data.signal_type || 'B';
                const typeClass = signalType === 'A' ? 'text-emerald-400' : (signalType === 'B' ? 'text-yellow-400' : 'text-red-400');
                const typeEmoji = signalType === 'A' ? 'ğŸŸ¢' : (signalType === 'B' ? 'ğŸŸ¡' : 'ğŸ”´');

                // AI ë¦¬í¬íŠ¸ í—¤ë” ì—…ë°ì´íŠ¸
                const signalHeader = document.querySelector('#tab-report .glass-card h3');
                if (signalHeader) {
                    signalHeader.innerHTML = `${typeEmoji} TYPE ${signalType} ${data.recommendation || 'ì‹ í˜¸'}`;
                    signalHeader.className = `font-bold text-lg ${typeClass} mb-3`;
                }

                // ìš”ì•½ ì¹´ë“œ ì—…ë°ì´íŠ¸ (ì‹ ë¢°ë„, ì ìˆ˜, Kelly, RR)
                const summaryGrid = document.querySelector('#tab-report .glass-card .grid');
                if (summaryGrid) {
                    summaryGrid.innerHTML = `
                        <div>
                            <div class="text-gray-400">ì‹ ë¢°ë„</div>
                            <div class="font-bold text-lg">${data.signal_confidence || 60}%</div>
                        </div>
                        <div>
                            <div class="text-gray-400">ìµœì¢… ì ìˆ˜</div>
                            <div class="font-bold text-lg ${typeClass}">${totalScore.toFixed(0)}/100</div>
                        </div>
                        <div>
                            <div class="text-gray-400">ì¶”ì²œ Kelly</div>
                            <div class="font-bold text-lg">${signalType === 'A' ? '4.0%' : (signalType === 'B' ? '2.0%' : '0%')}</div>
                        </div>
                        <div>
                            <div class="text-gray-400">ì‹œì¥ ìƒíƒœ</div>
                            <div class="font-bold text-lg">${data.market_state || 'NEUTRAL'}</div>
                        </div>
                    `;
                }

                // ì°¨íŠ¸ ìƒ‰ìƒ ê²°ì • (ì ìˆ˜ ê¸°ë°˜)
                const colors = scores.map(s => {
                    if (s >= 25) return '#10b981';     // ë…¹ìƒ‰ (ì¢‹ìŒ)
                    else if (s >= 15) return '#f59e0b'; // í™©ìƒ‰ (ì¤‘ë¦½)
                    else return '#ef4444';             // ì ìƒ‰ (ë‚˜ì¨)
                });

                // ê¸°ì¡´ ì°¨íŠ¸ íŒŒê´´
                if (currentChartInstance) {
                    currentChartInstance.destroy();
                    currentChartInstance = null;
                }

                // ìƒˆ ì°¨íŠ¸ ìƒì„±
                currentChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['ê¸°ìˆ ë¶„ì„', 'OnChain', 'ì‹œì¥ì‹¬ë¦¬', 'ë§¤í¬ë¡œ', 'ETF/ê¸°ê´€'],
                        datasets: [{
                            label: 'ë ˆì´ì–´ ì ìˆ˜ (/30)',
                            data: scores,
                            backgroundColor: colors,
                            borderRadius: 4,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => `${ctx.parsed.y}/30ì `
                                }
                            }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 30, ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                            x: { ticks: { color: '#9ca3af' }, grid: { display: false } }
                        }
                    }
                });

            } catch (e) {
                console.error('AI Report load error:', e);
                // í´ë°±: ê¸°ë³¸ ì°¨íŠ¸
                initFallbackLayerChart();
            }
        }

        // í´ë°± ë ˆì´ì–´ ì°¨íŠ¸ (API ì‹¤íŒ¨ ì‹œ)
        function initFallbackLayerChart() {
            const ctx = document.getElementById('layerChart');
            if (!ctx) return;

            if (currentChartInstance) {
                currentChartInstance.destroy();
            }

            currentChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ê¸°ìˆ ë¶„ì„', 'OnChain', 'ì‹œì¥ì‹¬ë¦¬', 'ë§¤í¬ë¡œ', 'ETF/ê¸°ê´€'],
                    datasets: [{
                        label: 'ë¶„ì„ ì ìˆ˜',
                        data: [20, 15, 18, 12, 22],
                        backgroundColor: ['#10b981', '#00d4ff', '#f59e0b', '#ef4444', '#10b981'],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 30, ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        x: { ticks: { color: '#9ca3af' }, grid: { display: false } }
                    }
                }
            });
        }

        // ê¸°ì¡´ initLayerChartë¥¼ loadAIReportë¡œ ëŒ€ì²´
        function initLayerChart() {
            loadAIReport();
        }

        // Market Map ë Œë”ë§
        function renderMarketMap() {
            const container = document.getElementById('market-map');
            if (!container) return;

            if (!marketMapData || marketMapData.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 col-span-4 py-10">ë°ì´í„° ë¡œë”© ì¤‘...</div>';
                return;
            }

            container.innerHTML = marketMapData.map(coin => {
                const colorClass = coin.change >= 3 ? 'bullish' : (coin.change <= -3 ? 'bearish' : 'neutral');
                const sizeClass = coin.size >= 3 ? 'col-span-2 row-span-2' : (coin.size >= 2 ? 'col-span-1 row-span-2' : '');

                return `
                    <div class="market-map-cell ${colorClass} ${sizeClass}" 
                         onclick="selectCoin('${coin.symbol}')"
                         title="${coin.name}: ${coin.change >= 0 ? '+' : ''}${coin.change.toFixed(1)}%">
                        <div class="font-bold text-xs">${coin.symbol}</div>
                        <div class="text-xs opacity-80">${coin.change >= 0 ? '+' : ''}${coin.change.toFixed(1)}%</div>
                    </div>
                `;
            }).join('');
        }

        let currentTimeframe = 'scalp'; // í˜„ì¬ íƒ€ì„í”„ë ˆì„ ìƒíƒœ

        // ì½”ì¸ ì¹´ë“œ ë Œë”ë§
        function renderCoinCard(coin, idx, isMajor) {
            const typeClass = coin.nice?.type === 'A' ? 'type-a' : (coin.nice?.type === 'B' ? 'type-b' : 'type-c');
            const scoreColor = coin.nice?.score >= 75 ? 'text-emerald-400' : (coin.nice?.score >= 55 ? 'text-yellow-400' : 'text-red-400');
            const changeColor = coin.change_24h >= 0 ? 'text-emerald-400' : 'text-red-400';
            const badgeClass = isMajor ? 'badge-major' : 'badge-other';
            const volumeFormatted = formatVolume(coin.volume_24h);

            return `
                <div class="coin-card ${coin.symbol === selectedCoin ? 'selected' : ''}" 
                     data-symbol="${coin.symbol}"
                     onclick="selectCoin('${coin.symbol}')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-lg">#${idx + 1}</span>
                            <div>
                                <div class="flex items-center gap-2">
                                    <span class="font-bold">${coin.symbol}</span>
                                    <span class="text-xs ${badgeClass} px-1 rounded">${isMajor ? 'ë©”ì´ì €' : 'ê¸°íƒ€'}</span>
                                </div>
                                <div class="text-xs text-gray-400">${coin.sector || ''}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="${changeColor} font-bold">${coin.change_24h >= 0 ? '+' : ''}${coin.change_24h?.toFixed(1)}%</div>
                            <div class="text-xs text-gray-400">Vol: ${volumeFormatted}</div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between mt-2 text-xs">
                        <span class="type-badge ${typeClass}">Type ${coin.nice?.type}</span>
                        <span class="${scoreColor} font-bold">NICE ${coin.nice?.score}</span>
                        <span class="text-gray-400">Kelly ${coin.trading?.kelly_pct}%</span>
                    </div>
                </div>
            `;
        }

        function formatVolume(vol) {
            if (vol >= 1e9) return `$${(vol / 1e9).toFixed(1)}B`;
            if (vol >= 1e6) return `$${(vol / 1e6).toFixed(0)}M`;
            return `$${vol?.toFixed(0) || 0}`;
        }

        // ì½”ì¸ ì„ íƒ ë° UI ì—…ë°ì´íŠ¸ (API ì—°ë™)
        async function selectCoin(symbol) {
            selectedCoin = symbol;

            // 1. ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            initTradingView(symbol, currentTimeframe);

            // 2. ì¹´ë“œ í•˜ì´ë¼ì´íŠ¸
            document.querySelectorAll('.coin-card').forEach(card => {
                if (card.dataset.symbol === symbol) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });

            // 3. APIì—ì„œ ì½”ì¸ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            try {
                const res = await fetch(`/api/crypto/coin/${symbol}`);
                const data = await res.json();

                if (data.error) {
                    console.error('Coin detail error:', data.error);
                    return;
                }

                // ìƒë‹¨ ì •ë³´ ì—…ë°ì´íŠ¸
                document.getElementById('chart-symbol').textContent = data.symbol;
                document.getElementById('chart-name').textContent = data.name;
                document.getElementById('chart-price').textContent = `$${data.price.toLocaleString()}`;
                document.getElementById('chart-change').textContent = `${data.change_24h >= 0 ? '+' : ''}${data.change_24h.toFixed(1)}%`;
                document.getElementById('chart-change').className = data.change_24h >= 0 ? 'text-emerald-400 text-sm' : 'text-red-400 text-sm';
                document.getElementById('selected-coin-name').textContent = `${data.symbol} ${data.name}`;


                // AI ë¶„ì„ íŒ¨ë„ ì—…ë°ì´íŠ¸ (ì•ˆì „í•œ ì ‘ê·¼)
                document.getElementById('ai-circulation').textContent = data.supply?.circulating_pct ? `${data.supply.circulating_pct.toFixed(1)}%` : '-';
                document.getElementById('ai-supply').textContent = data.supply?.total || '-';

                // ê³ ë˜ í¬ì§€ì…˜ ë§¤í•‘ (accumulating, distributing, holding)
                const whalePositionMap = {
                    'accumulating': 'ì¶•ì  ì¤‘',
                    'distributing': 'ë§¤ë„ ì¤‘',
                    'holding': 'ê´€ë§'
                };
                document.getElementById('ai-whale').textContent = whalePositionMap[data.whale?.position] || data.whale?.position || '-';
                document.getElementById('ai-whale-detail').textContent = data.whale?.wallet_count ? `${data.whale.wallet_count} ì§€ê°‘, ${data.whale.holding_pct?.toFixed(1) || 0}%` : '-';

                document.getElementById('ai-fractal').textContent = data.fractal?.pattern || '-';
                document.getElementById('ai-fractal-detail').textContent = data.fractal?.strength ? `ê°•ë„ ${data.fractal.strength.toFixed(0)}%` : '-';

                // ê±°ë˜ ì¶”ì²œ
                document.getElementById('ai-entry').textContent = data.trading?.entry_price ? `$${data.trading.entry_price.toLocaleString()}` : '-';
                document.getElementById('ai-sl').textContent = data.trading?.stop_loss ? `$${data.trading.stop_loss.toLocaleString()}` : '-';
                document.getElementById('ai-tp').textContent = data.trading?.take_profit ? `$${data.trading.take_profit.toLocaleString()}` : '-';

            } catch (e) {
                console.error('selectCoin API error:', e);
                // í´ë°±: ê¸°ë³¸ í‘œì‹œ
                document.getElementById('chart-symbol').textContent = symbol;
                document.getElementById('chart-name').textContent = symbol;
                document.getElementById('selected-coin-name').textContent = symbol;
            }
        }

        // í—¤ë” ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë“œ
        async function loadHeaderData() {
            try {
                const res = await fetch('/api/crypto/real-time');
                const data = await res.json();

                if (data.error) return;

                document.getElementById('top-signal').textContent = data.top_signal;
                document.getElementById('type-a-count').textContent = `${data.type_a_count}ê°œ`;
                document.getElementById('next-report').textContent = data.next_report;
                document.getElementById('avg-kelly').textContent = `${data.avg_kelly}%`;
                document.getElementById('fear-greed').textContent = `${data.fear_greed.value} ${data.fear_greed.label}`;
                document.getElementById('net-flow').textContent = `${data.net_flow.direction === 'in' ? '+' : '-'}$${Math.abs(data.net_flow.value).toFixed(1)}B`;
                document.getElementById('main-score').textContent = `${data.main_score}ì `;

                // Type ë°°ì§€ ì—…ë°ì´íŠ¸
                const typeBadge = document.getElementById('main-type');
                typeBadge.textContent = `Type ${data.main_type}`;
                typeBadge.className = `type-badge type-${data.main_type.toLowerCase()}`;

            } catch (e) {
                console.error('Header data error:', e);
            }
        }

        // ì „ë¬¸ê°€ ë¶„ì„ ë¡œë“œ (API ì—°ë™)
        async function loadExpertAnalysis() {
            const container = document.getElementById('expert-views');
            container.innerHTML = '<div class="text-center text-gray-400 py-4">ì „ë¬¸ê°€ ë°ì´í„° ë¶„ì„ ì¤‘...</div>';

            try {
                const res = await fetch('/api/nice/experts');
                const data = await res.json();

                if (data.error) {
                    container.innerHTML = '<div class="text-red-400">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div>';
                    return;
                }

                // ì „ë¬¸ê°€ ê´€ì  ë Œë”ë§
                const experts = data.experts || [];

                if (experts.length > 0) {
                    container.innerHTML = experts.map(exp => {
                        // ì‹ í˜¸ ìƒ‰ìƒ ê²°ì •
                        const signal = exp.signal || '';
                        let signalClass = 'text-gray-400';
                        if (signal.includes('ê°•í•œ ë§¤ìˆ˜') || signal.includes('ë§¤ìˆ˜')) {
                            signalClass = 'text-emerald-400';
                        } else if (signal.includes('ë§¤ë„')) {
                            signalClass = 'text-red-400';
                        } else if (signal.includes('ì¤‘ë¦½') || signal.includes('ê´€ë§')) {
                            signalClass = 'text-yellow-400';
                        }

                        return `
                            <div class="glass-card p-3 mb-2">
                                <div class="flex justify-between items-start mb-2">
                                    <span class="font-bold text-white">${exp.expert || exp.name || 'ì „ë¬¸ê°€'}</span>
                                    <span class="${signalClass} font-bold text-sm">${exp.signal || 'ë¶„ì„ ì¤‘'}</span>
                                </div>
                                <div class="text-xs text-gray-400 mb-2">${exp.reasoning || exp.action || ''}</div>
                                ${exp.key_factors && exp.key_factors.length > 0 ? `
                                    <div class="text-xs text-gray-500">
                                        ${exp.key_factors.slice(0, 2).map(f => `â€¢ ${f}`).join('<br>')}
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }).join('');

                    // ì»¨ì„¼ì„œìŠ¤ ì¶”ê°€
                    if (data.consensus) {
                        const consensusClass = data.consensus.signal?.includes('ë§¤ìˆ˜') ? 'text-emerald-400' : 'text-yellow-400';
                        container.innerHTML += `
                            <div class="glass-card p-3 mt-3 border border-emerald-500/30">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-emerald-400">ğŸ“Š ì»¨ì„¼ì„œìŠ¤</span>
                                    <span class="${consensusClass} font-bold">${data.consensus.signal || 'ë¶„ì„ ì¤‘'}</span>
                                </div>
                                <div class="text-xs text-gray-400 mt-1">ì‹ ë¢°ë„: ${data.consensus.confidence?.toFixed(0) || 0}%</div>
                            </div>
                        `;
                    }
                } else {
                    // ê¸°ë³¸ í‘œì‹œ
                    container.innerHTML = `
                        <div class="flow-item">
                            <span class="text-gray-400">BlackRock</span>
                            <span class="text-emerald-400 font-bold">ë¹„ì¤‘ í™•ëŒ€ (Overweight)</span>
                        </div>
                        <div class="flow-item">
                            <span class="text-gray-400">JP Morgan</span>
                            <span class="text-emerald-400 font-bold">ETF ìœ ì… ì§€ì†</span>
                        </div>
                        <div class="flow-item">
                            <span class="text-gray-400">Goldman Sachs</span>
                            <span class="text-yellow-400 font-bold">ì¤‘ë¦½ (Neutral)</span>
                        </div>
                    `;
                }
            } catch (e) {
                console.error('Expert analysis error:', e);
                container.innerHTML = `
                    <div class="text-red-400 text-center py-4">ì „ë¬¸ê°€ ë¶„ì„ ë¡œë“œ ì‹¤íŒ¨</div>
                `;
            }
        }

        // ìˆœìœ„ ë¡œë“œ (Timeframe íŒŒë¼ë¯¸í„° ì ìš©)
        async function loadRankings(timeframe = 'scalp') {
            try {
                // UI ë¡œë”© í‘œì‹œ
                const loadingHtml = '<div class="text-center text-gray-500 py-4 pulse">ë°ì´í„° ë¶„ì„ ì¤‘...</div>';
                document.getElementById('major-coins-list').innerHTML = loadingHtml;
                document.getElementById('other-coins-list').innerHTML = loadingHtml;
                document.getElementById('market-map').innerHTML = loadingHtml;

                const res = await fetch(`/api/crypto/rankings?timeframe=${timeframe}`);
                const data = await res.json();

                if (data.error) {
                    console.error('Rankings error:', data.error);
                    return;
                }

                // ë©”ì´ì € ì½”ì¸
                document.getElementById('major-coins-list').innerHTML =
                    data.major?.map((coin, idx) => renderCoinCard(coin, idx, true)).join('') || '<div class="text-gray-400">ë°ì´í„° ì—†ìŒ</div>';

                // ê¸°íƒ€ ì½”ì¸
                document.getElementById('other-coins-list').innerHTML =
                    data.other?.map((coin, idx) => renderCoinCard(coin, idx, false)).join('') || '<div class="text-gray-400">ë°ì´í„° ì—†ìŒ</div>';

                // Market Map ì—…ë°ì´íŠ¸ (ìˆœìœ„ ë°ì´í„° ê¸°ë°˜)
                const allCoins = [...(data.major || []), ...(data.other || [])];

                // Market Map ë°ì´í„° í˜•ì‹ ë³€í™˜ ë° ì •ë ¬
                marketMapData = allCoins.map(coin => ({
                    symbol: coin.symbol,
                    name: coin.name,
                    change: coin.change_24h,
                    sector: coin.sector || 'Other',
                    size: coin.is_major ? 4 : 2 // ë©”ì´ì €ëŠ” í¬ê²Œ
                })).sort((a, b) => Math.abs(b.change) - Math.abs(a.change)); // ë³€ë™í­ í° ìˆœì„œ

                renderMarketMap();

                // ì²«ë²ˆì§¸ ì½”ì¸ ìë™ ì„ íƒ (ë§Œì•½ ì„ íƒëœ ì½”ì¸ì´ ì—†ë‹¤ë©´)
                if (data.major && data.major.length > 0) {
                    // selectCoin(data.major[0].symbol); // (ì˜µì…˜: ìë™ ì„ íƒ ë„ê¸°)
                }

            } catch (e) {
                console.error('Rankings load error:', e);
            }
        }

        // ì¹´í…Œê³ ë¦¬ íƒ­ ì „í™˜ ë° ë°ì´í„° ë¦¬ë¡œë“œ
        document.addEventListener('DOMContentLoaded', () => {
            // ... (ê¸°ì¡´ ì´ˆê¸°í™” ì½”ë“œ)

            // íƒ­ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const tabName = this.dataset.tab;

                    // ë²„íŠ¼ í™œì„±í™”
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    // íƒ­ ì½˜í…ì¸  ì „í™˜ logic
                    if (tabName === 'report') {
                        // AI ë¦¬í¬íŠ¸ íƒ­ í‘œì‹œ
                        document.getElementById('dashboard-view').classList.remove('active');
                        const reportTab = document.getElementById('tab-report');
                        if (reportTab) reportTab.classList.add('active');

                        initLayerChart();
                        loadExpertAnalysis();
                    } else {
                        // íŠ¸ë ˆì´ë”© íƒ­ (í†µí•© ë·°) í‘œì‹œ
                        document.getElementById('tab-report').classList.remove('active');
                        document.getElementById('dashboard-view').classList.add('active');

                        // ë°ì´í„° ë¦¬ë¡œë“œ
                        currentTimeframe = tabName;
                        loadRankings(tabName);

                        // ì°¨íŠ¸ ì¸í„°ë²Œ ë³€ê²½
                        initTradingView(selectedCoin, tabName); // í˜„ì¬ ì„ íƒëœ ì½”ì¸ì˜ ì¸í„°ë²Œ ë³€ê²½

                        // ì •ë ¬ ê¸°ì¤€ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                        const sortText = {
                            'scalp': 'ìƒìŠ¹ëŸ‰ â†’ ê±°ë˜ëŸ‰ â†’ NICE',
                            'short': 'ì¶”ì„¸ê°•ë„ â†’ NICE ì ìˆ˜',
                            'medium': 'NICE ì ìˆ˜ â†’ ê³ ë˜ í¬ì§€ì…˜',
                            'long': 'ì‹œê°€ì´ì•¡ â†’ ê¸°ê´€ ì ìˆ˜'
                        };
                        document.getElementById('major-sort-criteria').textContent = sortText[tabName] || 'ìƒìŠ¹ëŸ‰ â†’ ê±°ë˜ëŸ‰';
                    }
                });
            });

            // ì´ˆê¸° ë¡œë“œ
            loadRankings('scalp');
            loadHeaderData();
            initTradingView('BTC', 'scalp');
            renderMarketMap();

            // í—¤ë” ìë™ ê°±ì‹  (30ì´ˆë§ˆë‹¤)
            setInterval(loadHeaderData, 30000);

            // íƒ€ì„ìŠ¤íƒ¬í”„ ì—…ë°ì´íŠ¸
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }) + ' ê°±ì‹ ';
        });
    </script>
</body>

</html>
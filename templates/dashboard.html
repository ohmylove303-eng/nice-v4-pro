<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NICE v4 PRO - ì „ë¬¸ê°€ ë ˆë²¨ AI ê±°ë˜ ì‹œìŠ¤í…œ</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap"
        rel="stylesheet">

    <style>
        * {
            font-family: 'Noto Sans KR', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a0a15 0%, #1a1a2e 100%);
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        /* Type ë±ƒì§€ */
        .type-a {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .type-b {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .type-c {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .type-badge {
            padding: 4px 12px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 11px;
        }

        /* ë©”ì´ì €/ê¸°íƒ€ ë±ƒì§€ */
        .badge-major {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid #f87171;
        }

        .badge-other {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid #fbbf24;
        }

        /* ì½”ì¸ ì¹´ë“œ */
        .coin-card {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .coin-card:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: #00d4ff;
            transform: translateY(-2px);
        }

        .coin-card.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.15);
        }

        /* Market Map */
        .market-map-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            font-size: 10px;
            font-weight: 700;
            border-radius: 4px;
            padding: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .market-map-cell:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .market-map-cell.bullish {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .market-map-cell.bearish {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .market-map-cell.neutral {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        /* ëª¨ë‹¬ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border-radius: 16px;
            padding: 24px;
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .score-bar-bg {
            background: rgba(0, 212, 255, 0.2);
            height: 5px;
            border-radius: 3px;
            overflow: hidden;
        }

        .fill-green {
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        .fill-yellow {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }

        .fill-red {
            background: linear-gradient(90deg, #ef4444, #f87171);
        }

        /* Flow ì•„ì´í…œ */
        .flow-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .flow-item:last-child {
            border-bottom: none;
        }

        /* ì§€í‘œ ë²„íŠ¼ */
        .indicator-btn {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .indicator-btn.active {
            background: rgba(16, 185, 129, 0.3);
            border: 1px solid #10b981;
        }

        .indicator-btn:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* ì¹´í…Œê³ ë¦¬ íƒ­ */
        .tab-btn {
            padding: 10px 16px;
            background: rgba(0, 212, 255, 0.15);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: #00d4ff;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab-btn.active {
            background: rgba(16, 185, 129, 0.4);
            border-color: #10b981;
            color: #10b981;
        }

        .tab-btn:hover {
            background: rgba(0, 212, 255, 0.25);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>

<body class="text-white">
    <div id="app" class="min-h-screen">

        <!-- í—¤ë” -->
        <header class="glass-card sticky top-0 z-50 mb-3" style="border-radius: 0;">
            <div class="container mx-auto px-3 py-2">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                        <h1 class="text-base font-black">ğŸ¯ NICE v4 PRO</h1>
                        <span id="main-type" class="type-badge type-a">Type A</span>
                        <span class="font-bold text-emerald-400" id="main-score">86ì </span>
                    </div>

                    <!-- ì½”ì¸ ê²€ìƒ‰ -->
                    <div class="relative flex-1 max-w-xs mx-4">
                        <div class="relative">
                            <input type="text" id="coin-search-input" placeholder="ğŸ” ì½”ì¸ ê²€ìƒ‰ (BTC, ETH, SOL...)"
                                class="w-full bg-gray-800/80 border border-gray-600 rounded-lg px-3 py-1.5 text-sm text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500"
                                autocomplete="off">
                            <button id="search-clear-btn"
                                class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white hidden">âœ•</button>
                        </div>
                        <div id="search-results"
                            class="absolute top-full left-0 right-0 bg-gray-900 border border-gray-700 rounded-lg mt-1 max-h-64 overflow-y-auto hidden z-50 shadow-xl">
                        </div>
                    </div>

                    <div class="flex items-center gap-3 text-xs">
                        <span class="pulse text-emerald-400">â— LIVE</span>
                        <span class="text-gray-400" id="last-update">18:40 ê°±ì‹ </span>
                    </div>
                </div>

                <!-- ìƒíƒœ ë°” -->
                <div class="grid grid-cols-3 md:grid-cols-6 gap-2 text-center text-xs">
                    <div class="glass-card p-2">
                        <div class="text-gray-400">ìµœê³  ì‹ í˜¸</div>
                        <div class="font-bold text-emerald-400" id="top-signal">BTC/ETH</div>
                    </div>
                    <div class="glass-card p-2">
                        <div class="text-gray-400">ğŸŸ¢ Type A</div>
                        <div class="font-bold" id="type-a-count">7ê°œ</div>
                    </div>
                    <div class="glass-card p-2">
                        <div class="text-gray-400">ë‹¤ìŒ ë¦¬í¬íŠ¸</div>
                        <div class="font-bold" id="next-report">19:00</div>
                    </div>
                    <div class="glass-card p-2">
                        <div class="text-gray-400">ì¶”ì²œ Kelly</div>
                        <div class="font-bold text-emerald-400" id="avg-kelly">3.1%</div>
                    </div>
                    <div class="glass-card p-2">
                        <div class="text-gray-400">Fear & Greed</div>
                        <div class="font-bold" id="fear-greed">55 íƒìš•</div>
                    </div>
                    <div class="glass-card p-2">
                        <div class="text-gray-400">Net Flow</div>
                        <div class="font-bold text-emerald-400" id="net-flow">+$2.4B</div>
                    </div>
                </div>
            </div>
        </header>

        <main class="container mx-auto px-3 space-y-3">

            <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
            <div class="flex gap-2 overflow-x-auto pb-2">
                <button class="tab-btn active" data-tab="scalp">ğŸ’¥ ë‹¨íƒ€ (5~30ë¶„)</button>
                <button class="tab-btn" data-tab="short">ğŸ“ˆ ë‹¨ê¸° (30ë¶„~2ì‹œê°„)</button>
                <button class="tab-btn" data-tab="medium">ğŸ”„ ì¤‘ê¸° (2ì‹œê°„~1ì¼)</button>
                <button class="tab-btn" data-tab="long">ğŸ“Š ì¥ê¸° (1ì¼~1ì£¼)</button>
                <button class="tab-btn" data-tab="report">ğŸ“‹ AI ë¦¬í¬íŠ¸</button>
            </div>

            <!-- íƒ­ ì½˜í…ì¸  ì»¨í…Œì´ë„ˆ (í†µí•© ë·°) -->
            <div id="dashboard-view" class="tab-content active">
                <!-- ì°¨íŠ¸ + Market Map -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-3">
                    <!-- TradingView ì°¨íŠ¸ -->
                    <div class="lg:col-span-2 glass-card p-3">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <span class="font-bold" id="chart-symbol">BTC</span>
                                <span class="text-gray-400 text-sm" id="chart-name">Bitcoin</span>
                                <span class="text-emerald-400 font-bold" id="chart-price">$45,200</span>
                                <span class="text-emerald-400 text-sm" id="chart-change">+2.5%</span>
                            </div>
                            <div class="flex gap-1" id="timeframe-buttons">
                                <button class="indicator-btn active" data-tf="5">5M</button>
                                <button class="indicator-btn" data-tf="15">15M</button>
                                <button class="indicator-btn" data-tf="60">1H</button>
                                <button class="indicator-btn" data-tf="240">4H</button>
                                <button class="indicator-btn" data-tf="D">1D</button>
                            </div>
                        </div>
                        <div id="tradingview-chart"
                            style="height: 320px; background: rgba(0,0,0,0.3); border-radius: 8px; overflow: hidden;">
                            <!-- TradingView Widget -->
                            <div id="tv-widget-container" style="width: 100%; height: 100%;"></div>
                        </div>
                        <!-- ì§€í‘œ ë°” (í™•ì¥) -->
                        <div class="flex gap-2 mt-2 flex-wrap">
                            <span class="indicator-btn active">BB (20,2)</span>
                            <span class="indicator-btn active">RSI (14)</span>
                            <span class="indicator-btn active">MACD (12,26,9)</span>
                            <span class="indicator-btn active">EMA (20/50/200)</span>
                            <span class="indicator-btn active">Volume</span>
                            <span class="indicator-btn active">Stoch RSI</span>
                            <!-- ìƒˆ ì§€í‘œ: Elliott Wave, Fibonacci, Trendline -->
                            <span class="indicator-btn active"
                                style="background: rgba(147, 51, 234, 0.3); border-color: #a855f7;">ZigZag (íŒŒë™)</span>
                            <span class="indicator-btn active"
                                style="background: rgba(234, 179, 8, 0.3); border-color: #eab308;">Pivot (í”¼ë³´ë‚˜ì¹˜)</span>
                            <span class="indicator-btn active"
                                style="background: rgba(6, 182, 212, 0.3); border-color: #06b6d4;">Ichimoku (êµ¬ë¦„)</span>
                            <span class="indicator-btn active"
                                style="background: rgba(236, 72, 153, 0.3); border-color: #ec4899;">PSAR (ì¶”ì„¸)</span>
                        </div>

                        <!-- ========== Elliott Wave / Fibonacci / Trendline ë¶„ì„ íŒ¨ë„ (NEW) ========== -->
                        <div class="glass-card p-3 mt-3" id="wave-analysis-panel">
                            <h4 class="font-bold text-sm mb-3 flex items-center gap-2">
                                <span>ğŸ“</span> ê¸°ìˆ ì  íŒŒë™ ë¶„ì„
                                <span class="text-xs text-gray-400" id="wave-coin-name">(BTC)</span>
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
                                <!-- Elliott Wave ë¶„ì„ -->
                                <div class="bg-gray-800/50 rounded-lg p-3 border-l-4 border-purple-500">
                                    <div class="text-purple-400 text-xs font-bold mb-2">ğŸŒŠ Elliott Wave</div>
                                    <div class="text-white font-bold text-lg mb-1" id="elliott-position">Wave 3 ìƒìŠ¹</div>
                                    <div class="text-xs text-gray-400" id="elliott-detail">
                                        5íŒŒ ìƒìŠ¹ ì¤‘ 3íŒŒ ì§„í–‰<br>
                                        ëª©í‘œ: 4íŒŒ ì¡°ì • í›„ 5íŒŒ ì‹ ê³ ê°€
                                    </div>
                                    <div class="mt-2 flex gap-1">
                                        <span
                                            class="px-2 py-0.5 bg-purple-500/20 text-purple-300 rounded text-xs">1</span>
                                        <span
                                            class="px-2 py-0.5 bg-purple-500/20 text-purple-300 rounded text-xs">2</span>
                                        <span class="px-2 py-0.5 bg-purple-500 text-white rounded text-xs font-bold"
                                            id="current-wave">3</span>
                                        <span class="px-2 py-0.5 bg-gray-700 text-gray-400 rounded text-xs">4</span>
                                        <span class="px-2 py-0.5 bg-gray-700 text-gray-400 rounded text-xs">5</span>
                                    </div>
                                </div>

                                <!-- Fibonacci ë ˆë²¨ -->
                                <div class="bg-gray-800/50 rounded-lg p-3 border-l-4 border-yellow-500">
                                    <div class="text-yellow-400 text-xs font-bold mb-2">ğŸ“Š Fibonacci Retracement</div>
                                    <div class="text-white font-bold mb-1" id="fib-position">61.8% ì§€ì§€ í…ŒìŠ¤íŠ¸</div>
                                    <div class="space-y-1 text-xs">
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">0.0% (ì €ì )</span>
                                            <span class="text-white" id="fib-0">$85,000</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">23.6%</span>
                                            <span class="text-gray-300" id="fib-236">$88,500</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">38.2%</span>
                                            <span class="text-gray-300" id="fib-382">$90,700</span>
                                        </div>
                                        <div class="flex justify-between bg-yellow-500/20 px-1 rounded">
                                            <span class="text-yellow-400 font-bold">50.0% â—€ í˜„ì¬</span>
                                            <span class="text-yellow-300 font-bold" id="fib-50">$92,500</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">61.8%</span>
                                            <span class="text-gray-300" id="fib-618">$94,300</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">100% (ê³ ì )</span>
                                            <span class="text-white" id="fib-100">$100,000</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Trendline ë¶„ì„ -->
                                <div class="bg-gray-800/50 rounded-lg p-3 border-l-4 border-cyan-500">
                                    <div class="text-cyan-400 text-xs font-bold mb-2">ğŸ“ˆ ì¶”ì„¸ì„  ë¶„ì„</div>
                                    <div class="text-white font-bold mb-1" id="trend-status">ìƒìŠ¹ ì¶”ì„¸ ìœ ì§€</div>
                                    <div class="space-y-2 text-xs">
                                        <div class="flex justify-between items-center">
                                            <span class="text-emerald-400">â–² ì£¼ìš” ì €í•­</span>
                                            <span class="text-emerald-300 font-bold"
                                                id="trend-resistance">$98,500</span>
                                        </div>
                                        <div class="flex justify-between items-center bg-cyan-500/20 px-1 rounded">
                                            <span class="text-cyan-400 font-bold">â—† í˜„ì¬ê°€</span>
                                            <span class="text-cyan-300 font-bold" id="trend-current">$92,500</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-red-400">â–¼ ì£¼ìš” ì§€ì§€</span>
                                            <span class="text-red-300 font-bold" id="trend-support">$88,000</span>
                                        </div>
                                        <div class="mt-2 pt-2 border-t border-gray-700">
                                            <div class="text-gray-400">ì¶”ì„¸ ê°•ë„</div>
                                            <div class="flex items-center gap-2 mt-1">
                                                <div class="flex-1 bg-gray-700 rounded-full h-2">
                                                    <div class="bg-gradient-to-r from-cyan-500 to-emerald-500 h-2 rounded-full"
                                                        id="trend-strength-bar" style="width: 72%"></div>
                                                </div>
                                                <span class="text-cyan-400 font-bold" id="trend-strength">72%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Market Map -->
                    <div class="glass-card p-3">
                        <h3 class="font-bold text-sm mb-2">ğŸ—ºï¸ ì‹œì¥ ì§€ë„ (Market Map)</h3>
                        <div class="grid grid-cols-4 gap-1" id="market-map" style="height: 320px; overflow-y: auto;">
                            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                            <div class="text-center text-gray-500 py-10">ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                </div>

                <!-- AI ë¶„ì„ íŒ¨ë„ -->
                <div class="glass-card p-3 mt-3" id="ai-analysis-panel">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-lg">ğŸ¤–</span>
                        <h3 class="font-bold">AI íˆ¬ì ë¶„ì„</h3>
                        <span class="text-xs text-gray-400" id="selected-coin-name">BTC Bitcoin</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3 text-sm" id="ai-analysis-content">
                        <!-- ìœ í†µëŸ‰ -->
                        <div class="glass-card p-3">
                            <div class="text-gray-400 text-xs mb-1">ğŸ“Š ìœ í†µëŸ‰</div>
                            <div class="font-bold" id="ai-circulation">-</div>
                            <div class="text-xs text-gray-400" id="ai-supply">-</div>
                        </div>
                        <!-- ì£¼í¬ í¬ì§„ -->
                        <div class="glass-card p-3">
                            <div class="text-gray-400 text-xs mb-1">ğŸ‹ ì£¼í¬ í¬ì§„</div>
                            <div class="font-bold text-emerald-400" id="ai-whale">-</div>
                            <div class="text-xs text-gray-400" id="ai-whale-detail">-</div>
                        </div>
                        <!-- í”„ë ‰íƒˆ í•¸ë“¤ë§ -->
                        <div class="glass-card p-3">
                            <div class="text-gray-400 text-xs mb-1">ğŸ“ í”„ë ‰íƒˆ í•¸ë“¤ë§</div>
                            <div class="font-bold text-cyan-400" id="ai-fractal">-</div>
                            <div class="text-xs text-gray-400" id="ai-fractal-detail">-</div>
                        </div>
                        <!-- ê±°ë˜ ì¶”ì²œ -->
                        <div class="glass-card p-3">
                            <div class="text-gray-400 text-xs mb-1">ğŸ¯ ê±°ë˜ ì¶”ì²œ</div>
                            <div class="grid grid-cols-3 gap-1 text-xs">
                                <div><span class="text-gray-400">ì§„ì…</span><br><span class="font-bold"
                                        id="ai-entry">-</span></div>
                                <div><span class="text-gray-400">ì†ì ˆ</span><br><span class="text-red-400 font-bold"
                                        id="ai-sl">-</span></div>
                                <div><span class="text-gray-400">ìµì ˆ</span><br><span class="text-emerald-400 font-bold"
                                        id="ai-tp">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Final Top 5 Tables -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 mt-3">

                    <!-- ë©”ì´ì € ì½”ì¸ Top 5 -->
                    <div class="glass-card p-3">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">ğŸ†</span>
                                <h3 class="font-bold">Final Top 5 - ë©”ì´ì € ì½”ì¸</h3>
                            </div>
                            <span class="text-xs text-gray-400" id="major-sort-criteria">ìƒìŠ¹ëŸ‰ â†’ ê±°ë˜ëŸ‰ â†’ NICE</span>
                        </div>
                        <div class="space-y-2" id="major-coins-list">
                            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                            <div class="text-center text-gray-500 py-4">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>

                    <!-- ê¸°íƒ€ ì½”ì¸ Top 5 -->
                    <div class="glass-card p-3">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">â­</span>
                                <h3 class="font-bold">Final Top 5 - ê¸°íƒ€ ì½”ì¸</h3>
                            </div>
                            <span class="text-xs text-gray-400">ê³ ìˆ˜ìµ Â· ê³ ë³€ë™</span>
                        </div>
                        <div class="space-y-2" id="other-coins-list">
                            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                            <div class="text-center text-gray-500 py-4">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI ë¦¬í¬íŠ¸ íƒ­ (ê³ ì • ë ˆì´ì•„ì›ƒ) -->
            <div id="tab-report" class="tab-content"
                style="height: calc(100vh - 180px); display: flex; flex-direction: column; overflow: hidden;">
                <!-- ìƒë‹¨ ìš”ì•½ ì¹´ë“œ (ê³ ì • ë†’ì´) -->
                <div class="glass-card p-3 mb-2" style="flex-shrink: 0;">
                    <h3 class="font-bold text-lg text-emerald-400 mb-2">ğŸŸ¢ TYPE A ì‹ í˜¸ í¬ì°©!</h3>
                    <div class="grid grid-cols-4 gap-3 text-sm">
                        <div>
                            <div class="text-gray-400 text-xs">ì‹ ë¢°ë„</div>
                            <div class="font-bold">76%</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">ìµœì¢… ì ìˆ˜</div>
                            <div class="font-bold text-emerald-400">86/100</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">ì¶”ì²œ Kelly</div>
                            <div class="font-bold">4.0%</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">ì‹œì¥ ìƒíƒœ</div>
                            <div class="font-bold">BULL</div>
                        </div>
                    </div>
                </div>

                <!-- ì¤‘ê°„ ì˜ì—­: ì°¨íŠ¸ (40%) + ì „ë¬¸ê°€ (60%) -->
                <div class="flex-1 grid grid-cols-5 gap-2 min-h-0">
                    <!-- ë ˆì´ì–´ ì°¨íŠ¸ (40%) -->
                    <div class="col-span-2 glass-card p-3 flex flex-col">
                        <h3 class="font-bold text-sm mb-2">ğŸ“Š ë ˆì´ì–´ë³„ ë¶„ì„</h3>
                        <div class="flex-1 min-h-0">
                            <canvas id="layerChart" style="width: 100%; height: 100%;"></canvas>
                        </div>
                    </div>

                    <!-- ì „ë¬¸ê°€ ê´€ì  (60%) - ìŠ¤í¬ë¡¤ ê°€ëŠ¥ -->
                    <div class="col-span-3 glass-card p-3 flex flex-col">
                        <h3 class="font-bold text-sm mb-2">ğŸ’¼ ì „ë¬¸ê°€ ê´€ì </h3>
                        <div id="expert-views" class="flex-1 overflow-y-auto space-y-2 text-sm pr-1"
                            style="max-height: 100%;">
                            ë¡œë”© ì¤‘...
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- ì½”ì¸ ìƒì„¸ ë¶„ì„ ëª¨ë‹¬ -->
        <div class="modal-overlay" id="coin-modal">
            <div class="modal-content" style="max-width: 900px;">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-3">
                        <h2 class="text-xl font-bold" id="modal-title">BTC Bitcoin</h2>
                        <span id="modal-type-badge" class="type-badge type-a">Type A</span>
                        <span id="modal-price" class="text-emerald-400 font-bold">$98,000</span>
                        <span id="modal-change" class="text-emerald-400">+2.5%</span>
                    </div>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                </div>

                <!-- ë¯¸ë‹ˆ ì°¨íŠ¸ -->
                <div class="glass-card p-3 mb-4" style="height: 200px;">
                    <div id="modal-chart-container" style="width: 100%; height: 100%;"></div>
                </div>

                <!-- AI íˆ¬ì ë¶„ì„ -->
                <div class="glass-card p-3 mb-4">
                    <h3 class="font-bold text-emerald-400 mb-3">ğŸ¤– AI íˆ¬ì ë¶„ì„</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                        <div class="glass-card p-2">
                            <div class="text-gray-400 text-xs">ğŸ“Š ìœ í†µëŸ‰</div>
                            <div class="font-bold" id="modal-circulation">93.2%</div>
                            <div class="text-xs text-gray-400" id="modal-supply">19.8M / 21M</div>
                        </div>
                        <div class="glass-card p-2">
                            <div class="text-gray-400 text-xs">ğŸ‹ ì£¼í¬ í¬ì§„</div>
                            <div class="font-bold text-cyan-400" id="modal-whale">ì¶•ì  ì¤‘</div>
                            <div class="text-xs text-gray-400" id="modal-whale-detail">152 ì§€ê°‘, 38.5%</div>
                        </div>
                        <div class="glass-card p-2">
                            <div class="text-gray-400 text-xs">ğŸ“ í”„ë ‰íƒˆ í•¸ë“¤ë§</div>
                            <div class="font-bold text-purple-400" id="modal-fractal">Higher High</div>
                            <div class="text-xs text-gray-400" id="modal-fractal-detail">ê°•ë„ 82%</div>
                        </div>
                        <div class="glass-card p-2">
                            <div class="text-gray-400 text-xs">ğŸ¯ NICE ì ìˆ˜</div>
                            <div class="font-bold text-emerald-400" id="modal-nice-score">86</div>
                            <div class="text-xs text-gray-400" id="modal-nice-type">Type A ì‹ í˜¸</div>
                        </div>
                    </div>
                </div>

                <!-- ê±°ë˜ ì¶”ì²œ -->
                <div class="glass-card p-3 mb-4" style="background: rgba(16, 185, 129, 0.1); border-color: #10b981;">
                    <h3 class="font-bold text-emerald-400 mb-3">ğŸ¯ ê±°ë˜ ì¶”ì²œ (í˜„ì¬ ì‹œê°„ ê¸°ì¤€)</h3>
                    <div class="grid grid-cols-3 md:grid-cols-6 gap-3 text-center text-sm">
                        <div>
                            <div class="text-gray-400 text-xs">ì§„ì…ê°€</div>
                            <div class="font-bold text-cyan-400" id="modal-entry">$97,500</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">ì†ì ˆê°€ (SL)</div>
                            <div class="font-bold text-red-400" id="modal-sl">$95,550</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">ìµì ˆê°€ (TP)</div>
                            <div class="font-bold text-emerald-400" id="modal-tp">$101,920</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">ì†ìµë¹„ (R:R)</div>
                            <div class="font-bold text-yellow-400" id="modal-rr">1:2.2</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">Kelly %</div>
                            <div class="font-bold" id="modal-kelly">4.0%</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs">Time-Stop</div>
                            <div class="font-bold" id="modal-timestop">30ë¶„</div>
                        </div>
                    </div>
                </div>

                <!-- ë§¤ìˆ˜/ë§¤ë„ ë²„íŠ¼ -->
                <div class="grid grid-cols-2 gap-4">
                    <button id="modal-buy-btn" class="py-3 rounded-lg font-bold text-lg transition-all hover:scale-105"
                        style="background: linear-gradient(135deg, #10b981, #059669);">
                        ğŸ“ˆ ë§¤ìˆ˜ ì¶”ì²œ
                    </button>
                    <button id="modal-sell-btn"
                        class="py-3 rounded-lg font-bold text-lg transition-all hover:scale-105 opacity-50"
                        style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                        ğŸ“‰ ë§¤ë„ (ë³´ë¥˜)
                    </button>
                </div>

                <!-- ì‹œê°„ ì •ë³´ -->
                <div class="text-center text-xs text-gray-400 mt-3">
                    ë¶„ì„ ì‹œê°: <span id="modal-time">19:45:00</span> | ìœ íš¨ ì‹œê°„: 30ë¶„ | ë‹¤ìŒ ê°±ì‹ : <span
                        id="modal-next-update">20:00</span>
                </div>
            </div>
        </div>

        <footer class="text-center py-3 text-gray-500 text-xs">
            NICE v4 PRO | ë¸”ë™ë¡ Ã— JPëª¨ê±´ Ã— ì „ë¬¸ íŠ¸ë ˆì´ë” í†µí•© ë¶„ì„ | ë¹—ì¸ 448ê°œ ì½”ì¸ ë¶„ì„
        </footer>
    </div>

    <!-- TradingView ìœ„ì ¯ ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <script>
        let selectedCoin = 'BTC';
        let tvWidget = null;

        // ì‹œì¥ ì§€ë„ ë°ì´í„°
        let marketMapData = [
            { symbol: 'BTC', name: 'Bitcoin', change: 2.5, sector: 'L1', size: 4 },
            { symbol: 'ETH', name: 'Ethereum', change: 3.2, sector: 'L1', size: 3 },
            { symbol: 'SOL', name: 'Solana', change: 5.1, sector: 'L1', size: 2 },
            { symbol: 'XRP', name: 'Ripple', change: 1.8, sector: 'L1', size: 2 },
            { symbol: 'BNB', name: 'BNB', change: -1.2, sector: 'Ex', size: 2 },
            { symbol: 'DOGE', name: 'Doge', change: 8.5, sector: 'Meme', size: 2 },
            { symbol: 'ADA', name: 'Cardano', change: -0.5, sector: 'L1', size: 1 },
            { symbol: 'AVAX', name: 'Avalanche', change: 4.2, sector: 'L1', size: 1 },
            { symbol: 'DOT', name: 'Polkadot', change: -2.1, sector: 'L1', size: 1 },
            { symbol: 'LINK', name: 'Chainlink', change: 2.1, sector: 'DeFi', size: 1 },
            { symbol: 'MATIC', name: 'Polygon', change: 1.5, sector: 'L2', size: 1 },
            { symbol: 'SHIB', name: 'Shiba', change: 12.3, sector: 'Meme', size: 1 },
            { symbol: 'PEPE', name: 'Pepe', change: 15.2, sector: 'Meme', size: 1 },
            { symbol: 'APT', name: 'Aptos', change: 6.8, sector: 'L1', size: 1 },
            { symbol: 'SUI', name: 'Sui', change: 9.2, sector: 'L1', size: 1 },
            { symbol: 'OP', name: 'Optimism', change: 3.5, sector: 'L2', size: 1 },
            { symbol: 'ARB', name: 'Arbitrum', change: -1.8, sector: 'L2', size: 1 },
            { symbol: 'UNI', name: 'Uniswap', change: 2.8, sector: 'DeFi', size: 1 },
            { symbol: 'NEAR', name: 'Near', change: 3.5, sector: 'L1', size: 1 },
            { symbol: 'WIF', name: 'Dogwifhat', change: 18.5, sector: 'Meme', size: 1 }
        ];

        // TradingView ìœ„ì ¯ ì´ˆê¸°í™” (Elliott Wave, Fibonacci, ì¶”ì„¸ì„  í¬í•¨)
        function initTradingView(symbol = 'BTC', interval = '5') {
            const container = document.getElementById('tv-widget-container');
            container.innerHTML = '';

            // TradingView Interval ë§¤í•‘
            const intervalMap = {
                'scalp': '5',
                'short': '15',
                'medium': '60',
                'long': '240'  // 4ì‹œê°„
            };

            // ë§Œì•½ interval íŒŒë¼ë¯¸í„°ê°€ timeframe ë¬¸ìì—´ì´ë©´ ë§¤í•‘ëœ ê°’ ì‚¬ìš©
            const tvInterval = intervalMap[interval] || interval;

            new TradingView.widget({
                "autosize": true,
                "symbol": `BITHUMB:${symbol}KRW`,
                "interval": tvInterval,
                "timezone": "Asia/Seoul",
                "theme": "dark",
                "style": "1",
                "locale": "kr",
                "toolbar_bg": "#1a1a2e",
                "enable_publishing": false,
                "hide_top_toolbar": false,
                "hide_legend": false,
                "save_image": false,
                "container_id": "tv-widget-container",
                "withdateranges": true,
                "allow_symbol_change": true,
                "details": true,
                "hotlist": true,
                "calendar": false,
                "studies": [
                    // ê¸°ë³¸ ì§€í‘œ
                    "BB@tv-basicstudies",               // ë³¼ë¦°ì € ë°´ë“œ
                    "RSI@tv-basicstudies",              // RSI
                    "MACD@tv-basicstudies",             // MACD
                    "Volume@tv-basicstudies",           // ê±°ë˜ëŸ‰
                    "StochasticRSI@tv-basicstudies",    // ìŠ¤í† ìºìŠ¤í‹± RSI

                    // ì´ë™í‰ê· ì„  (EMA)
                    "MAExp@tv-basicstudies",            // EMA 20
                    "MAExp@tv-basicstudies",            // EMA 50
                    "MAExp@tv-basicstudies",            // EMA 200

                    // ì¶”ê°€ ê¸°ìˆ ì  ì§€í‘œ - Elliott Wave, Fibonacci, Trendline
                    "PSAR@tv-basicstudies",             // Parabolic SAR (ì¶”ì„¸)
                    "PivotPointsStandard@tv-basicstudies", // í”¼ë´‡ í¬ì¸íŠ¸ (ì§€ì§€/ì €í•­)
                    "ZigZag@tv-basicstudies",           // ì§€ê·¸ì¬ê·¸ (íŒŒë™ íŒ¨í„´)
                    "IchimokuCloud@tv-basicstudies",    // ì¼ëª©ê· í˜•í‘œ (êµ¬ë¦„)
                    "ADX@tv-basicstudies"               // ADX (ì¶”ì„¸ ê°•ë„)
                ],
                "studies_overrides": {
                    "volume.volume.color.0": "#ef4444",
                    "volume.volume.color.1": "#10b981",
                    // EMA ì„¤ì •
                    "moving average exponential.length": 20,
                    // ZigZag ì„¤ì • (íŒŒë™ ë¶„ì„ìš©)
                    "zigzag.deviation": 5
                }
            });

            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.indicator-btn[data-tf]').forEach(btn => btn.classList.remove('active'));
            // ê°€ì¥ ê·¼ì ‘í•œ ë²„íŠ¼ ì°¾ê¸° (ë‹¨ìˆœí™”)
            const btn = document.querySelector(`.indicator-btn[data-tf="${tvInterval}"]`) ||
                document.querySelector(`.indicator-btn[data-tf="5"]`);
            if (btn) btn.classList.add('active');
        }

        let currentChartInstance = null; // ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì „ì—­ ê´€ë¦¬
        // AI ë¦¬í¬íŠ¸ ë°ì´í„° ë¡œë“œ (ë ˆì´ì–´ ì°¨íŠ¸ + ìš”ì•½)
        async function loadAIReport() {
            const ctx = document.getElementById('layerChart');
            if (!ctx) return;

            try {
                // ì‹œì¥ ë¶„ì„ API í˜¸ì¶œ
                const res = await fetch('/api/nice/market');
                const data = await res.json();

                if (data.error) {
                    console.error('AI Report error:', data.error);
                    return;
                }

                // ë ˆì´ì–´ ì ìˆ˜ ì¶”ì¶œ
                const layers = data.layers || {};
                const scores = [
                    layers.technical?.score || 0,
                    layers.onchain?.score || 0,
                    layers.sentiment?.score || 0,
                    layers.macro?.score || 0,
                    layers.etf?.score || 0
                ];

                // ì´ì  ë° ì‹ í˜¸ íƒ€ì… ì—…ë°ì´íŠ¸
                const totalScore = data.total_score || 0;
                const signalType = data.signal_type || 'B';
                const typeClass = signalType === 'A' ? 'text-emerald-400' : (signalType === 'B' ? 'text-yellow-400' : 'text-red-400');
                const typeEmoji = signalType === 'A' ? 'ğŸŸ¢' : (signalType === 'B' ? 'ğŸŸ¡' : 'ğŸ”´');

                // AI ë¦¬í¬íŠ¸ í—¤ë” ì—…ë°ì´íŠ¸
                const signalHeader = document.querySelector('#tab-report .glass-card h3');
                if (signalHeader) {
                    signalHeader.innerHTML = `${typeEmoji} TYPE ${signalType} ${data.recommendation || 'ì‹ í˜¸'}`;
                    signalHeader.className = `font-bold text-lg ${typeClass} mb-3`;
                }

                // ìš”ì•½ ì¹´ë“œ ì—…ë°ì´íŠ¸ (ì‹ ë¢°ë„, ì ìˆ˜, Kelly, RR)
                const summaryGrid = document.querySelector('#tab-report .glass-card .grid');
                if (summaryGrid) {
                    summaryGrid.innerHTML = `
                        <div>
                            <div class="text-gray-400">ì‹ ë¢°ë„</div>
                            <div class="font-bold text-lg">${data.signal_confidence || 60}%</div>
                        </div>
                        <div>
                            <div class="text-gray-400">ìµœì¢… ì ìˆ˜</div>
                            <div class="font-bold text-lg ${typeClass}">${totalScore.toFixed(0)}/100</div>
                        </div>
                        <div>
                            <div class="text-gray-400">ì¶”ì²œ Kelly</div>
                            <div class="font-bold text-lg">${signalType === 'A' ? '4.0%' : (signalType === 'B' ? '2.0%' : '0%')}</div>
                        </div>
                        <div>
                            <div class="text-gray-400">ì‹œì¥ ìƒíƒœ</div>
                            <div class="font-bold text-lg">${data.market_state || 'NEUTRAL'}</div>
                        </div>
                    `;
                }

                // ì°¨íŠ¸ ìƒ‰ìƒ ê²°ì • (ì ìˆ˜ ê¸°ë°˜)
                const colors = scores.map(s => {
                    if (s >= 25) return '#10b981';     // ë…¹ìƒ‰ (ì¢‹ìŒ)
                    else if (s >= 15) return '#f59e0b'; // í™©ìƒ‰ (ì¤‘ë¦½)
                    else return '#ef4444';             // ì ìƒ‰ (ë‚˜ì¨)
                });

                // ê¸°ì¡´ ì°¨íŠ¸ íŒŒê´´
                if (currentChartInstance) {
                    currentChartInstance.destroy();
                    currentChartInstance = null;
                }

                // ìƒˆ ì°¨íŠ¸ ìƒì„±
                currentChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['ê¸°ìˆ ë¶„ì„', 'OnChain', 'ì‹œì¥ì‹¬ë¦¬', 'ë§¤í¬ë¡œ', 'ETF/ê¸°ê´€'],
                        datasets: [{
                            label: 'ë ˆì´ì–´ ì ìˆ˜ (/30)',
                            data: scores,
                            backgroundColor: colors,
                            borderRadius: 4,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => `${ctx.parsed.y}/30ì `
                                }
                            }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 30, ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                            x: { ticks: { color: '#9ca3af' }, grid: { display: false } }
                        }
                    }
                });

            } catch (e) {
                console.error('AI Report load error:', e);
                // í´ë°±: ê¸°ë³¸ ì°¨íŠ¸
                initFallbackLayerChart();
            }
        }

        // í´ë°± ë ˆì´ì–´ ì°¨íŠ¸ (API ì‹¤íŒ¨ ì‹œ)
        function initFallbackLayerChart() {
            const ctx = document.getElementById('layerChart');
            if (!ctx) return;

            if (currentChartInstance) {
                currentChartInstance.destroy();
            }

            currentChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ê¸°ìˆ ë¶„ì„', 'OnChain', 'ì‹œì¥ì‹¬ë¦¬', 'ë§¤í¬ë¡œ', 'ETF/ê¸°ê´€'],
                    datasets: [{
                        label: 'ë¶„ì„ ì ìˆ˜',
                        data: [20, 15, 18, 12, 22],
                        backgroundColor: ['#10b981', '#00d4ff', '#f59e0b', '#ef4444', '#10b981'],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 30, ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        x: { ticks: { color: '#9ca3af' }, grid: { display: false } }
                    }
                }
            });
        }

        // ê¸°ì¡´ initLayerChartë¥¼ loadAIReportë¡œ ëŒ€ì²´
        function initLayerChart() {
            loadAIReport();
        }

        // Market Map ë Œë”ë§
        function renderMarketMap() {
            const container = document.getElementById('market-map');
            if (!container) return;

            if (!marketMapData || marketMapData.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 col-span-4 py-10">ë°ì´í„° ë¡œë”© ì¤‘...</div>';
                return;
            }

            container.innerHTML = marketMapData.map(coin => {
                const colorClass = coin.change >= 3 ? 'bullish' : (coin.change <= -3 ? 'bearish' : 'neutral');
                const sizeClass = coin.size >= 3 ? 'col-span-2 row-span-2' : (coin.size >= 2 ? 'col-span-1 row-span-2' : '');

                return `
                    <div class="market-map-cell ${colorClass} ${sizeClass}" 
                         onclick="selectCoin('${coin.symbol}')"
                         title="${coin.name}: ${coin.change >= 0 ? '+' : ''}${coin.change.toFixed(1)}%">
                        <div class="font-bold text-xs">${coin.symbol}</div>
                        <div class="text-xs opacity-80">${coin.change >= 0 ? '+' : ''}${coin.change.toFixed(1)}%</div>
                    </div>
                `;
            }).join('');
        }

        let currentTimeframe = 'scalp'; // í˜„ì¬ íƒ€ì„í”„ë ˆì„ ìƒíƒœ

        // ì½”ì¸ ì¹´ë“œ ë Œë”ë§
        function renderCoinCard(coin, idx, isMajor) {
            const typeClass = coin.nice?.type === 'A' ? 'type-a' : (coin.nice?.type === 'B' ? 'type-b' : 'type-c');
            const scoreColor = coin.nice?.score >= 75 ? 'text-emerald-400' : (coin.nice?.score >= 55 ? 'text-yellow-400' : 'text-red-400');
            const changeColor = coin.change_24h >= 0 ? 'text-emerald-400' : 'text-red-400';
            const badgeClass = isMajor ? 'badge-major' : 'badge-other';
            const volumeFormatted = formatVolume(coin.volume_24h);

            return `
                <div class="coin-card ${coin.symbol === selectedCoin ? 'selected' : ''}" 
                     data-symbol="${coin.symbol}"
                     onclick="selectCoin('${coin.symbol}')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-lg">#${idx + 1}</span>
                            <div>
                                <div class="flex items-center gap-2">
                                    <span class="font-bold">${coin.symbol}</span>
                                    <span class="text-xs ${badgeClass} px-1 rounded">${isMajor ? 'ë©”ì´ì €' : 'ê¸°íƒ€'}</span>
                                </div>
                                <div class="text-xs text-gray-400">${coin.sector || ''}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="${changeColor} font-bold">${coin.change_24h >= 0 ? '+' : ''}${coin.change_24h?.toFixed(1)}%</div>
                            <div class="text-xs text-gray-400">Vol: ${volumeFormatted}</div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between mt-2 text-xs">
                        <span class="type-badge ${typeClass}">Type ${coin.nice?.type}</span>
                        <span class="${scoreColor} font-bold">NICE ${coin.nice?.score}</span>
                        <span class="text-gray-400">Kelly ${coin.trading?.kelly_pct}%</span>
                    </div>
                </div>
            `;
        }

        function formatVolume(vol) {
            if (vol >= 1e9) return `$${(vol / 1e9).toFixed(1)}B`;
            if (vol >= 1e6) return `$${(vol / 1e6).toFixed(0)}M`;
            return `$${vol?.toFixed(0) || 0}`;
        }

        // CoinGecko API ID ë§¤í•‘
        function getCoinGeckoId(symbol) {
            const idMap = {
                'BTC': 'bitcoin', 'ETH': 'ethereum', 'SOL': 'solana',
                'XRP': 'ripple', 'BNB': 'binancecoin', 'DOGE': 'dogecoin',
                'ADA': 'cardano', 'AVAX': 'avalanche-2', 'DOT': 'polkadot',
                'LINK': 'chainlink', 'MATIC': 'matic-network', 'SHIB': 'shiba-inu',
                'PEPE': 'pepe', 'BONK': 'bonk', 'WIF': 'dogwifcoin', 'FLOKI': 'floki',
                'SUI': 'sui', 'OP': 'optimism', 'ARB': 'arbitrum', 'NEAR': 'near',
                'APT': 'aptos', 'UNI': 'uniswap', 'TRX': 'tron', 'TON': 'the-open-network'
            };
            return idMap[symbol.toUpperCase()] || symbol.toLowerCase();
        }

        // ì½”ì¸ ì„ íƒ ë° UI ì—…ë°ì´íŠ¸ (API ì—°ë™ - ëª¨ë“  ì½”ì¸ ì§€ì›)
        async function selectCoin(symbol) {
            selectedCoin = symbol;

            // 1. ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            initTradingView(symbol, currentTimeframe);

            // 2. ì¹´ë“œ í•˜ì´ë¼ì´íŠ¸
            document.querySelectorAll('.coin-card').forEach(card => {
                if (card.dataset.symbol === symbol) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });

            // 3. APIì—ì„œ ì½”ì¸ ë¶„ì„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ëª¨ë“  ì½”ì¸ ì§€ì›)
            try {
                const res = await fetch(`/api/crypto/analysis/${symbol}`);
                const data = await res.json();

                if (data.error) {
                    console.error('Coin analysis error:', data.error);
                    return;
                }

                // ê°€ê²© ë°ì´í„° í™•ë³´ (fallback ë¡œì§)
                let price = data.price || 0;
                let change = data.change_24h || 0;

                // ê°€ê²©ì´ ì—†ìœ¼ë©´ marketMapDataì—ì„œ ì°¾ê¸°
                if (!price || price === 0) {
                    const mapCoin = marketMapData.find(c => c.symbol === symbol);
                    if (mapCoin && mapCoin.price) {
                        price = mapCoin.price;
                    }
                    if (mapCoin && mapCoin.change) {
                        change = mapCoin.change;
                    }
                }

                // ì—¬ì „íˆ ê°€ê²©ì´ ì—†ìœ¼ë©´ CoinGeckoì—ì„œ ê°€ì ¸ì˜¤ê¸°
                if (!price || price === 0) {
                    try {
                        const cgRes = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${getCoinGeckoId(symbol)}&vs_currencies=usd&include_24hr_change=true`);
                        const cgData = await cgRes.json();
                        const coinId = getCoinGeckoId(symbol);
                        if (cgData[coinId]) {
                            price = cgData[coinId].usd || 0;
                            change = cgData[coinId].usd_24h_change || 0;
                        }
                    } catch (cgErr) {
                        console.warn('CoinGecko fallback failed:', cgErr);
                    }
                }

                // ìƒë‹¨ ì •ë³´ ì—…ë°ì´íŠ¸
                document.getElementById('chart-symbol').textContent = data.symbol || symbol;
                document.getElementById('chart-name').textContent = data.name || symbol;
                document.getElementById('chart-price').textContent = price ? `$${price.toLocaleString()}` : '-';
                document.getElementById('chart-change').textContent = `${change >= 0 ? '+' : ''}${change.toFixed(1)}%`;
                document.getElementById('chart-change').className = change >= 0 ? 'text-emerald-400 text-sm' : 'text-red-400 text-sm';
                document.getElementById('selected-coin-name').textContent = `${data.symbol || symbol} ${data.name || ''}`;

                // AI ë¶„ì„ íŒ¨ë„ ì—…ë°ì´íŠ¸
                document.getElementById('ai-circulation').textContent = data.circulation ? `${data.circulation}%` : '-';
                document.getElementById('ai-supply').textContent = data.circulating ? `${(data.circulating / 1e9).toFixed(2)}B` : '-';

                // ê³ ë˜ í¬ì§€ì…˜
                document.getElementById('ai-whale').textContent = data.whale || '-';
                document.getElementById('ai-whale-detail').textContent = data.whale_wallets ? `${data.whale_wallets} ì§€ê°‘, ${data.whale_holding_pct?.toFixed(1) || 0}%` : '-';

                // í”„ë ‰íƒˆ
                document.getElementById('ai-fractal').textContent = data.fractal || '-';
                document.getElementById('ai-fractal-detail').textContent = data.fractal_strength ? `ê°•ë„ ${data.fractal_strength}%` : '-';

                // ê±°ë˜ ì¶”ì²œ (ëª¨ë“  ì½”ì¸ì—ì„œ ì‘ë™ - price ê¸°ë°˜ ê³„ì‚°)
                const entryPrice = data.entry_price || (price * 0.98);
                const stopLoss = data.stop_loss || (price * 0.95);
                const takeProfit = data.take_profit || (price * 1.05);

                document.getElementById('ai-entry').textContent = price ? `$${entryPrice.toLocaleString(undefined, { maximumFractionDigits: 6 })}` : '-';
                document.getElementById('ai-sl').textContent = price ? `$${stopLoss.toLocaleString(undefined, { maximumFractionDigits: 6 })}` : '-';
                document.getElementById('ai-tp').textContent = price ? `$${takeProfit.toLocaleString(undefined, { maximumFractionDigits: 6 })}` : '-';

                // 4. íŒŒë™ ë¶„ì„ íŒ¨ë„ ì—…ë°ì´íŠ¸ (ê°€ê²© ë°ì´í„° í•„ìˆ˜)
                if (price > 0) {
                    updateWaveAnalysis(symbol, price, change, data);
                }

            } catch (e) {
                console.error('selectCoin API error:', e);
                // í´ë°±: ê¸°ë³¸ í‘œì‹œ
                document.getElementById('chart-symbol').textContent = symbol;
                document.getElementById('chart-name').textContent = symbol;
                document.getElementById('selected-coin-name').textContent = symbol;
            }
        }

        // Elliott Wave / Fibonacci / Trendline ë¶„ì„ ì—…ë°ì´íŠ¸
        function updateWaveAnalysis(symbol, price, change, data) {
            // íŒŒë™ ë¶„ì„ ì½”ì¸ ì´ë¦„ ì—…ë°ì´íŠ¸
            document.getElementById('wave-coin-name').textContent = `(${symbol})`;

            // Elliott Wave ë¶„ì„ (ë³€ë™ë¥  ê¸°ë°˜)
            let wavePosition, waveDetail, currentWave;
            if (change > 5) {
                wavePosition = 'Wave 3 ê°•ì„¸';
                waveDetail = '5íŒŒ ìƒìŠ¹ ì¤‘ 3íŒŒ ì§„í–‰<br>ê°€ì¥ ê°•ë ¥í•œ ìƒìŠ¹ íŒŒë™';
                currentWave = 3;
            } else if (change > 2) {
                wavePosition = 'Wave 5 ì§„í–‰';
                waveDetail = 'ìµœì¢… ìƒìŠ¹íŒŒ ì§„í–‰ ì¤‘<br>ì‹ ê³ ê°€ ë„ì „ ê°€ëŠ¥';
                currentWave = 5;
            } else if (change > 0) {
                wavePosition = 'Wave 1 ì‹œì‘';
                waveDetail = 'ìƒˆë¡œìš´ ìƒìŠ¹ ì‚¬ì´í´ ì‹œì‘<br>ì¶”ì„¸ í™•ì¸ í•„ìš”';
                currentWave = 1;
            } else if (change > -3) {
                wavePosition = 'Wave 2 ì¡°ì •';
                waveDetail = 'ê±´ê°•í•œ ëˆŒë¦¼ëª© êµ¬ê°„<br>ë§¤ìˆ˜ ê¸°íšŒ íƒìƒ‰';
                currentWave = 2;
            } else {
                wavePosition = 'Wave 4 ì¡°ì •';
                waveDetail = 'ìƒìŠ¹ ì „ ë§ˆì§€ë§‰ ì¡°ì •<br>ì§€ì§€ ë ˆë²¨ í…ŒìŠ¤íŠ¸ ì¤‘';
                currentWave = 4;
            }
            document.getElementById('elliott-position').textContent = wavePosition;
            document.getElementById('elliott-detail').innerHTML = waveDetail;

            // íŒŒë™ ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸
            const waveButtons = document.getElementById('current-wave').parentElement.children;
            for (let i = 0; i < waveButtons.length; i++) {
                if (i + 1 === currentWave) {
                    waveButtons[i].className = 'px-2 py-0.5 bg-purple-500 text-white rounded text-xs font-bold';
                } else if (i + 1 < currentWave) {
                    waveButtons[i].className = 'px-2 py-0.5 bg-purple-500/20 text-purple-300 rounded text-xs';
                } else {
                    waveButtons[i].className = 'px-2 py-0.5 bg-gray-700 text-gray-400 rounded text-xs';
                }
            }

            // Fibonacci ë ˆë²¨ ê³„ì‚°
            const high = price * 1.1;  // ìµœê·¼ ê³ ì  ì¶”ì •
            const low = price * 0.9;   // ìµœê·¼ ì €ì  ì¶”ì •
            const range = high - low;

            document.getElementById('fib-0').textContent = `$${low.toLocaleString(undefined, { maximumFractionDigits: 2 })}`;
            document.getElementById('fib-236').textContent = `$${(low + range * 0.236).toLocaleString(undefined, { maximumFractionDigits: 2 })}`;
            document.getElementById('fib-382').textContent = `$${(low + range * 0.382).toLocaleString(undefined, { maximumFractionDigits: 2 })}`;
            document.getElementById('fib-50').textContent = `$${(low + range * 0.5).toLocaleString(undefined, { maximumFractionDigits: 2 })}`;
            document.getElementById('fib-618').textContent = `$${(low + range * 0.618).toLocaleString(undefined, { maximumFractionDigits: 2 })}`;
            document.getElementById('fib-100').textContent = `$${high.toLocaleString(undefined, { maximumFractionDigits: 2 })}`;

            // í˜„ì¬ Fibonacci ìœ„ì¹˜
            const fibLevel = (price - low) / range * 100;
            let fibPosition;
            if (fibLevel >= 78.6) fibPosition = '78.6% ìƒë‹¨';
            else if (fibLevel >= 61.8) fibPosition = '61.8% ì €í•­';
            else if (fibLevel >= 50) fibPosition = '50% ì˜ì—­';
            else if (fibLevel >= 38.2) fibPosition = '38.2% ì§€ì§€';
            else if (fibLevel >= 23.6) fibPosition = '23.6% í•˜ë‹¨';
            else fibPosition = 'ì €ì  í…ŒìŠ¤íŠ¸';
            document.getElementById('fib-position').textContent = fibPosition;

            // ì¶”ì„¸ì„  ë¶„ì„
            const support = price * 0.95;
            const resistance = price * 1.08;
            document.getElementById('trend-current').textContent = `$${price.toLocaleString(undefined, { maximumFractionDigits: 2 })}`;
            document.getElementById('trend-support').textContent = `$${support.toLocaleString(undefined, { maximumFractionDigits: 2 })}`;
            document.getElementById('trend-resistance').textContent = `$${resistance.toLocaleString(undefined, { maximumFractionDigits: 2 })}`;

            // ì¶”ì„¸ ìƒíƒœ
            const trendStatus = change > 3 ? 'ê°•í•œ ìƒìŠ¹ ì¶”ì„¸' : (change > 0 ? 'ìƒìŠ¹ ì¶”ì„¸ ìœ ì§€' : (change > -3 ? 'íš¡ë³´/ì¡°ì •' : 'í•˜ë½ ì¶”ì„¸'));
            document.getElementById('trend-status').textContent = trendStatus;

            // ì¶”ì„¸ ê°•ë„
            const strength = Math.min(100, Math.abs(change) * 10 + 50);
            document.getElementById('trend-strength').textContent = `${strength.toFixed(0)}%`;
            document.getElementById('trend-strength-bar').style.width = `${strength}%`;
        }

        // í—¤ë” ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë“œ
        async function loadHeaderData() {
            try {
                const res = await fetch('/api/crypto/real-time');
                const data = await res.json();

                if (data.error) return;

                document.getElementById('top-signal').textContent = data.top_signal;
                document.getElementById('type-a-count').textContent = `${data.type_a_count}ê°œ`;
                document.getElementById('next-report').textContent = data.next_report;
                document.getElementById('avg-kelly').textContent = `${data.avg_kelly}%`;
                document.getElementById('fear-greed').textContent = `${data.fear_greed.value} ${data.fear_greed.label}`;
                document.getElementById('net-flow').textContent = `${data.net_flow.direction === 'in' ? '+' : '-'}$${Math.abs(data.net_flow.value).toFixed(1)}B`;
                document.getElementById('main-score').textContent = `${data.main_score}ì `;

                // Type ë°°ì§€ ì—…ë°ì´íŠ¸
                const typeBadge = document.getElementById('main-type');
                typeBadge.textContent = `Type ${data.main_type}`;
                typeBadge.className = `type-badge type-${data.main_type.toLowerCase()}`;

            } catch (e) {
                console.error('Header data error:', e);
            }
        }

        // ì „ë¬¸ê°€ ë¶„ì„ ë¡œë“œ (ê³¼ê±°â†’í˜„ì¬â†’ë¯¸ë˜ + NICE ë ˆì´ì–´ë³„ ë¶„ì„)
        async function loadExpertAnalysis() {
            const container = document.getElementById('expert-views');
            container.innerHTML = '<div class="text-center text-gray-400 py-4">ğŸ”„ NICE ë ˆì´ì–´ ë¶„ì„ ì¤‘...</div>';

            try {
                const res = await fetch('/api/nice/experts');
                const data = await res.json();

                if (data.error) {
                    container.innerHTML = '<div class="text-red-400">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div>';
                    return;
                }

                let html = '';

                // ========== 1. íƒ€ì„ë¼ì¸ ë¶„ì„ (ê³¼ê±°â†’í˜„ì¬â†’ë¯¸ë˜) ==========
                if (data.timeline) {
                    const tl = data.timeline;
                    html += `
                        <div class="glass-card p-4 mb-4">
                            <h4 class="font-bold text-white mb-3">ğŸ“Š ì‹œì¥ íƒ€ì„ë¼ì¸ ë¶„ì„</h4>
                            <div class="space-y-3">
                                <div class="flex items-start gap-3">
                                    <span class="text-gray-500 font-bold min-w-[60px]">ğŸ“œ ê³¼ê±°</span>
                                    <span class="text-gray-300 text-sm">${tl.past}</span>
                                </div>
                                <div class="flex items-start gap-3">
                                    <span class="text-emerald-400 font-bold min-w-[60px]">ğŸ“ í˜„ì¬</span>
                                    <span class="text-emerald-300 text-sm">${tl.present}</span>
                                </div>
                                <div class="flex items-start gap-3">
                                    <span class="text-cyan-400 font-bold min-w-[60px]">ğŸ”® ë¯¸ë˜</span>
                                    <span class="text-cyan-300 text-sm">${tl.future}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // ========== 2. NICE ë ˆì´ì–´ë³„ ë¶„ì„ ==========
                if (data.layer_analysis) {
                    const layers = data.layer_analysis;
                    html += '<div class="glass-card p-4 mb-4"><h4 class="font-bold text-white mb-3">ğŸ“ˆ NICE 5-Layer ìƒì„¸ ë¶„ì„</h4><div class="space-y-3">';

                    const layerKeys = ['layer1_technical', 'layer2_onchain', 'layer3_sentiment', 'layer4_macro', 'layer5_institutional'];
                    const layerColors = ['#8b5cf6', '#10b981', '#f59e0b', '#3b82f6', '#ec4899'];

                    layerKeys.forEach((key, idx) => {
                        const layer = layers[key];
                        if (layer) {
                            const pct = (layer.score / layer.max * 100).toFixed(0);
                            const statusColor = layer.status.includes('ê°•ì„¸') || layer.status.includes('ì¶•ì ') || layer.status.includes('ìš°í˜¸') || layer.status.includes('ë§¤ì§‘') || layer.status.includes('íƒìš•')
                                ? '#10b981' : (layer.status.includes('ì•½ì„¸') || layer.status.includes('ë¶„ë°°') || layer.status.includes('ë¹„ìš°í˜¸') || layer.status.includes('ë§¤ë„') || layer.status.includes('ê³µí¬') ? '#ef4444' : '#eab308');

                            html += `
                                <div class="bg-gray-800/50 rounded-lg p-3 border-l-4" style="border-color: ${layerColors[idx]}">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-bold text-white text-sm">${layer.name}</span>
                                        <div class="flex items-center gap-2">
                                            <span class="text-xs px-2 py-0.5 rounded" style="background: ${statusColor}20; color: ${statusColor}">${layer.status}</span>
                                            <span class="text-white font-bold">${layer.score}/${layer.max}</span>
                                        </div>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-1.5 mb-2">
                                        <div class="h-1.5 rounded-full" style="width: ${pct}%; background: ${layerColors[idx]}"></div>
                                    </div>
                                    <div class="grid grid-cols-3 gap-2 text-xs">
                                        <div><span class="text-gray-500">ê³¼ê±°</span><p class="text-gray-400 mt-0.5">${layer.past}</p></div>
                                        <div><span class="text-emerald-500">í˜„ì¬</span><p class="text-gray-300 mt-0.5">${layer.present}</p></div>
                                        <div><span class="text-cyan-500">ë¯¸ë˜</span><p class="text-gray-400 mt-0.5">${layer.future}</p></div>
                                    </div>
                                </div>
                            `;
                        }
                    });

                    html += '</div></div>';
                }

                // ========== 3. ì „ë¬¸ê°€ ì˜ê²¬ ==========
                const experts = data.experts || [];
                if (experts.length > 0) {
                    html += '<div class="glass-card p-4"><h4 class="font-bold text-white mb-3">ğŸ‘” ì „ë¬¸ê°€ ì˜ê²¬</h4><div class="grid grid-cols-2 gap-2">';

                    experts.forEach(exp => {
                        const signal = exp.signal || '';
                        let signalClass = 'text-gray-400';
                        if (signal.includes('ê°•í•œ ë§¤ìˆ˜') || signal.includes('ë§¤ìˆ˜')) signalClass = 'text-emerald-400';
                        else if (signal.includes('ë§¤ë„')) signalClass = 'text-red-400';
                        else if (signal.includes('ì¤‘ë¦½') || signal.includes('ê´€ë§')) signalClass = 'text-yellow-400';

                        html += `
                            <div class="bg-gray-800/30 rounded p-2">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-white text-xs">${exp.expert || exp.name}</span>
                                    <span class="${signalClass} font-bold text-xs">${exp.signal}</span>
                                </div>
                                <div class="text-[10px] text-gray-500 mt-1">${exp.action || ''}</div>
                            </div>
                        `;
                    });

                    html += '</div>';

                    // ì»¨ì„¼ì„œìŠ¤
                    if (data.consensus) {
                        const consensusClass = data.consensus.signal?.includes('ë§¤ìˆ˜') ? 'text-emerald-400' : 'text-yellow-400';
                        html += `
                            <div class="mt-3 p-2 border border-emerald-500/30 rounded-lg flex justify-between items-center">
                                <span class="font-bold text-emerald-400">ğŸ“Š ì»¨ì„¼ì„œìŠ¤</span>
                                <div>
                                    <span class="${consensusClass} font-bold">${data.consensus.signal}</span>
                                    <span class="text-gray-500 text-xs ml-2">(ì‹ ë¢°ë„ ${data.consensus.confidence?.toFixed(0) || 0}%)</span>
                                </div>
                            </div>
                        `;
                    }
                    html += '</div>';
                }

                container.innerHTML = html || '<div class="text-gray-400 text-center py-4">ë¶„ì„ ë°ì´í„° ì—†ìŒ</div>';
            } catch (e) {
                console.error('Expert analysis error:', e);
                container.innerHTML = `
                    <div class="text-red-400 text-center py-4">ì „ë¬¸ê°€ ë¶„ì„ ë¡œë“œ ì‹¤íŒ¨</div>
                `;
            }
        }

        // ìˆœìœ„ ë¡œë“œ (Timeframe íŒŒë¼ë¯¸í„° ì ìš©)
        async function loadRankings(timeframe = 'scalp') {
            try {
                // UI ë¡œë”© í‘œì‹œ
                const loadingHtml = '<div class="text-center text-gray-500 py-4 pulse">ë°ì´í„° ë¶„ì„ ì¤‘...</div>';
                document.getElementById('major-coins-list').innerHTML = loadingHtml;
                document.getElementById('other-coins-list').innerHTML = loadingHtml;
                document.getElementById('market-map').innerHTML = loadingHtml;

                const res = await fetch(`/api/crypto/rankings?timeframe=${timeframe}`);
                const data = await res.json();

                if (data.error) {
                    console.error('Rankings error:', data.error);
                    return;
                }

                // ë©”ì´ì € ì½”ì¸
                document.getElementById('major-coins-list').innerHTML =
                    data.major?.map((coin, idx) => renderCoinCard(coin, idx, true)).join('') || '<div class="text-gray-400">ë°ì´í„° ì—†ìŒ</div>';

                // ê¸°íƒ€ ì½”ì¸
                document.getElementById('other-coins-list').innerHTML =
                    data.other?.map((coin, idx) => renderCoinCard(coin, idx, false)).join('') || '<div class="text-gray-400">ë°ì´í„° ì—†ìŒ</div>';

                // Market Map ì—…ë°ì´íŠ¸ (ìˆœìœ„ ë°ì´í„° ê¸°ë°˜)
                const allCoins = [...(data.major || []), ...(data.other || [])];

                // Market Map ë°ì´í„° í˜•ì‹ ë³€í™˜ ë° ì •ë ¬
                marketMapData = allCoins.map(coin => ({
                    symbol: coin.symbol,
                    name: coin.name,
                    change: coin.change_24h,
                    sector: coin.sector || 'Other',
                    size: coin.is_major ? 4 : 2 // ë©”ì´ì €ëŠ” í¬ê²Œ
                })).sort((a, b) => Math.abs(b.change) - Math.abs(a.change)); // ë³€ë™í­ í° ìˆœì„œ

                renderMarketMap();

                // ì²«ë²ˆì§¸ ì½”ì¸ ìë™ ì„ íƒ (ë§Œì•½ ì„ íƒëœ ì½”ì¸ì´ ì—†ë‹¤ë©´)
                if (data.major && data.major.length > 0) {
                    // selectCoin(data.major[0].symbol); // (ì˜µì…˜: ìë™ ì„ íƒ ë„ê¸°)
                }

            } catch (e) {
                console.error('Rankings load error:', e);
            }
        }

        // ì¹´í…Œê³ ë¦¬ íƒ­ ì „í™˜ ë° ë°ì´í„° ë¦¬ë¡œë“œ
        document.addEventListener('DOMContentLoaded', () => {
            // ... (ê¸°ì¡´ ì´ˆê¸°í™” ì½”ë“œ)

            // ========== ì½”ì¸ ê²€ìƒ‰ ê¸°ëŠ¥ ==========
            const coinDatabase = [
                // ë©”ì´ì € ì½”ì¸
                { symbol: 'BTC', name: 'Bitcoin', sector: 'L1' },
                { symbol: 'ETH', name: 'Ethereum', sector: 'L1' },
                { symbol: 'SOL', name: 'Solana', sector: 'L1' },
                { symbol: 'XRP', name: 'Ripple', sector: 'L1' },
                { symbol: 'BNB', name: 'BNB', sector: 'Exchange' },
                { symbol: 'ADA', name: 'Cardano', sector: 'L1' },
                { symbol: 'AVAX', name: 'Avalanche', sector: 'L1' },
                { symbol: 'DOT', name: 'Polkadot', sector: 'L1' },
                { symbol: 'LINK', name: 'Chainlink', sector: 'DeFi' },
                { symbol: 'MATIC', name: 'Polygon', sector: 'L2' },
                // ë°ˆ ì½”ì¸
                { symbol: 'DOGE', name: 'Dogecoin', sector: 'Meme' },
                { symbol: 'SHIB', name: 'Shiba Inu', sector: 'Meme' },
                { symbol: 'PEPE', name: 'Pepe', sector: 'Meme' },
                { symbol: 'BONK', name: 'Bonk', sector: 'Meme' },
                { symbol: 'WIF', name: 'Dogwifhat', sector: 'Meme' },
                { symbol: 'FLOKI', name: 'Floki', sector: 'Meme' },
                // ê¸°íƒ€
                { symbol: 'SUI', name: 'Sui', sector: 'L1' },
                { symbol: 'OP', name: 'Optimism', sector: 'L2' },
                { symbol: 'ARB', name: 'Arbitrum', sector: 'L2' },
                { symbol: 'NEAR', name: 'Near Protocol', sector: 'L1' },
                { symbol: 'APT', name: 'Aptos', sector: 'L1' },
                { symbol: 'UNI', name: 'Uniswap', sector: 'DeFi' },
                { symbol: 'ATOM', name: 'Cosmos', sector: 'L1' },
                { symbol: 'FIL', name: 'Filecoin', sector: 'Storage' },
                { symbol: 'TRX', name: 'Tron', sector: 'L1' },
                { symbol: 'TON', name: 'Toncoin', sector: 'L1' },
                { symbol: 'LTC', name: 'Litecoin', sector: 'L1' },
                { symbol: 'BCH', name: 'Bitcoin Cash', sector: 'L1' },
                { symbol: 'FTM', name: 'Fantom', sector: 'L1' },
                { symbol: 'INJ', name: 'Injective', sector: 'DeFi' },
                { symbol: 'AAVE', name: 'Aave', sector: 'DeFi' },
                { symbol: 'MKR', name: 'Maker', sector: 'DeFi' },
                { symbol: 'CRV', name: 'Curve', sector: 'DeFi' },
                { symbol: 'SAND', name: 'The Sandbox', sector: 'GameFi' },
                { symbol: 'MANA', name: 'Decentraland', sector: 'GameFi' },
                { symbol: 'AXS', name: 'Axie Infinity', sector: 'GameFi' },
                { symbol: 'GALA', name: 'Gala', sector: 'GameFi' },
                { symbol: 'IMX', name: 'Immutable', sector: 'L2' },
                { symbol: 'RENDER', name: 'Render', sector: 'AI' },
                { symbol: 'FET', name: 'Fetch.ai', sector: 'AI' },
                { symbol: 'AGIX', name: 'SingularityNET', sector: 'AI' }
            ];

            const searchInput = document.getElementById('coin-search-input');
            const searchResults = document.getElementById('search-results');
            const clearBtn = document.getElementById('search-clear-btn');
            let selectedIndex = -1;

            // ê²€ìƒ‰ ì…ë ¥ ì´ë²¤íŠ¸
            searchInput.addEventListener('input', function () {
                const query = this.value.trim().toUpperCase();

                if (query.length === 0) {
                    searchResults.classList.add('hidden');
                    clearBtn.classList.add('hidden');
                    return;
                }

                clearBtn.classList.remove('hidden');

                // ê²€ìƒ‰ í•„í„°ë§
                const filtered = coinDatabase.filter(coin =>
                    coin.symbol.includes(query) ||
                    coin.name.toUpperCase().includes(query)
                ).slice(0, 10);

                if (filtered.length === 0) {
                    searchResults.innerHTML = '<div class="p-3 text-gray-400 text-sm">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                } else {
                    searchResults.innerHTML = filtered.map((coin, idx) => `
                        <div class="search-result-item px-3 py-2 hover:bg-gray-800 cursor-pointer flex items-center gap-2 ${idx === selectedIndex ? 'bg-gray-800' : ''}" 
                             data-symbol="${coin.symbol}" data-index="${idx}">
                            <span class="font-bold text-white">${coin.symbol}</span>
                            <span class="text-gray-400 text-sm">${coin.name}</span>
                            <span class="ml-auto text-xs px-2 py-0.5 rounded bg-gray-700 text-gray-300">${coin.sector}</span>
                        </div>
                    `).join('');
                }

                searchResults.classList.remove('hidden');
            });

            // ê²€ìƒ‰ ê²°ê³¼ í´ë¦­
            searchResults.addEventListener('click', function (e) {
                const item = e.target.closest('.search-result-item');
                if (item) {
                    const symbol = item.dataset.symbol;
                    selectCoinFromSearch(symbol);
                }
            });

            // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
            searchInput.addEventListener('keydown', function (e) {
                const items = searchResults.querySelectorAll('.search-result-item');

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
                    updateSearchSelection(items);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    selectedIndex = Math.max(selectedIndex - 1, 0);
                    updateSearchSelection(items);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (selectedIndex >= 0 && items[selectedIndex]) {
                        const symbol = items[selectedIndex].dataset.symbol;
                        selectCoinFromSearch(symbol);
                    } else if (this.value.trim()) {
                        // ì§ì ‘ ì…ë ¥í•œ ì‹¬ë³¼ë¡œ ê²€ìƒ‰
                        selectCoinFromSearch(this.value.trim().toUpperCase());
                    }
                } else if (e.key === 'Escape') {
                    searchResults.classList.add('hidden');
                    selectedIndex = -1;
                }
            });

            // ì„ íƒ í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸
            function updateSearchSelection(items) {
                items.forEach((item, idx) => {
                    if (idx === selectedIndex) {
                        item.classList.add('bg-gray-800');
                    } else {
                        item.classList.remove('bg-gray-800');
                    }
                });
            }

            // ê²€ìƒ‰ì—ì„œ ì½”ì¸ ì„ íƒ
            function selectCoinFromSearch(symbol) {
                searchInput.value = symbol;
                searchResults.classList.add('hidden');
                selectedIndex = -1;

                // selectCoin í•¨ìˆ˜ í˜¸ì¶œ (TradingView, íŒŒë™ ë¶„ì„, AI ë¶„ì„ ì—°ë™)
                selectCoin(symbol);

                // ì„±ê³µ í”¼ë“œë°±
                searchInput.style.borderColor = '#22c55e';
                setTimeout(() => {
                    searchInput.style.borderColor = '';
                }, 1000);
            }

            // í´ë¦¬ì–´ ë²„íŠ¼
            clearBtn.addEventListener('click', function () {
                searchInput.value = '';
                searchResults.classList.add('hidden');
                clearBtn.classList.add('hidden');
                selectedIndex = -1;
            });

            // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.addEventListener('click', function (e) {
                if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.classList.add('hidden');
                    selectedIndex = -1;
                }
            });

            // í¬ì»¤ìŠ¤ ì‹œ ì´ì „ ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
            searchInput.addEventListener('focus', function () {
                if (this.value.trim().length > 0) {
                    searchResults.classList.remove('hidden');
                }
            });

            // ========== ê¸°ì¡´ íƒ­ ë²„íŠ¼ ì´ë²¤íŠ¸ ==========
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const tabName = this.dataset.tab;

                    // ë²„íŠ¼ í™œì„±í™”
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    // íƒ­ ì½˜í…ì¸  ì „í™˜ logic
                    if (tabName === 'report') {
                        // AI ë¦¬í¬íŠ¸ íƒ­ í‘œì‹œ
                        document.getElementById('dashboard-view').classList.remove('active');
                        const reportTab = document.getElementById('tab-report');
                        if (reportTab) reportTab.classList.add('active');

                        initLayerChart();
                        loadExpertAnalysis();
                    } else {
                        // íŠ¸ë ˆì´ë”© íƒ­ (í†µí•© ë·°) í‘œì‹œ
                        document.getElementById('tab-report').classList.remove('active');
                        document.getElementById('dashboard-view').classList.add('active');

                        // ë°ì´í„° ë¦¬ë¡œë“œ
                        currentTimeframe = tabName;
                        loadRankings(tabName);

                        // ì°¨íŠ¸ ì¸í„°ë²Œ ë³€ê²½
                        initTradingView(selectedCoin, tabName); // í˜„ì¬ ì„ íƒëœ ì½”ì¸ì˜ ì¸í„°ë²Œ ë³€ê²½

                        // ì •ë ¬ ê¸°ì¤€ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                        const sortText = {
                            'scalp': 'ìƒìŠ¹ëŸ‰ â†’ ê±°ë˜ëŸ‰ â†’ NICE',
                            'short': 'ì¶”ì„¸ê°•ë„ â†’ NICE ì ìˆ˜',
                            'medium': 'NICE ì ìˆ˜ â†’ ê³ ë˜ í¬ì§€ì…˜',
                            'long': 'ì‹œê°€ì´ì•¡ â†’ ê¸°ê´€ ì ìˆ˜'
                        };
                        document.getElementById('major-sort-criteria').textContent = sortText[tabName] || 'ìƒìŠ¹ëŸ‰ â†’ ê±°ë˜ëŸ‰';
                    }
                });
            });

            // ì´ˆê¸° ë¡œë“œ
            loadRankings('scalp');
            loadHeaderData();
            initTradingView('BTC', 'scalp');
            renderMarketMap();

            // í—¤ë” ìë™ ê°±ì‹  (30ì´ˆë§ˆë‹¤)
            setInterval(loadHeaderData, 30000);

            // íƒ€ì„ìŠ¤íƒ¬í”„ ì—…ë°ì´íŠ¸
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }) + ' ê°±ì‹ ';
        });
    </script>
</body>

</html>